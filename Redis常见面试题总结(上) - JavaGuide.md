[è·³è‡³ä¸»è¦å…§å®¹](#main-content)

[![](https://javaguide.cn/database/redis/redis-questions-01.html#redis-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/logo.png)JavaGuide](/)

[é¢è¯•æŒ‡å—](/home.html)

[å¼€æºé¡¹ç›®](/open-source-project/)

[æŠ€æœ¯ä¹¦ç±](/books/)

[ç¨‹åºäººç”Ÿ](/high-quality-technical-articles/)

çŸ¥è¯†æ˜Ÿçƒ

- [æ˜Ÿçƒä»‹ç»](/about-the-author/zhishixingqiu-two-years.html)
- [æ˜Ÿçƒä¸“å±ä¼˜è´¨ä¸“æ ](/zhuanlan/)
- [æ˜Ÿçƒä¼˜è´¨ä¸»é¢˜æ±‡æ€»](https://www.yuque.com/snailclimb/rpkqw1/ncxpnfmlng08wlf1)

ç½‘ç«™ç›¸å…³

- [å…³äºä½œè€…](/about-the-author/)
- [æ›´æ–°å†å²](/timeline/)

[](https://github.com/Snailclimb/JavaGuide)

- é¡¹ç›®ä»‹ç»
    
- é¢è¯•å‡†å¤‡ï¼ˆå¿…çœ‹ï¼‰
    
- Java
    
- è®¡ç®—æœºåŸºç¡€
    
- æ•°æ®åº“
    
    - åŸºç¡€
        
        - [æ•°æ®åº“åŸºç¡€çŸ¥è¯†æ€»ç»“](/database/basis.html)
        - [NoSQLåŸºç¡€çŸ¥è¯†æ€»ç»“](/database/nosql.html)
        - [å­—ç¬¦é›†è¯¦è§£](/database/character-set.html)
        - SQL
            
        
    - MySQL
        
        - [MySQLå¸¸è§é¢è¯•é¢˜æ€»ç»“](/database/mysql/mysql-questions-01.html)
        - [MySQLé«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“](/database/mysql/mysql-high-performance-optimization-specification-recommendations.html)
        - é‡è¦çŸ¥è¯†ç‚¹
            
        
    - Redis
        
        - [ç¼“å­˜åŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä»˜è´¹)](/database/redis/cache-basics.html)
        - [Rediså¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)](/database/redis/redis-questions-01.html)
        - [Rediså¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)](/database/redis/redis-questions-02.html)
        - é‡è¦çŸ¥è¯†ç‚¹
            
        
    - Elasticsearch
        
    - MongoDB
        
    
- å¼€å‘å·¥å…·
    
- å¸¸ç”¨æ¡†æ¶
    
- ç³»ç»Ÿè®¾è®¡
    
- åˆ†å¸ƒå¼
    
- é«˜æ€§èƒ½
    
- é«˜å¯ç”¨
    

# Rediså¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)

[Guide](https://javaguide.cn/article/)æ•°æ®åº“Redisçº¦ 13737 å­—å¤§çº¦ 46 åˆ†é’Ÿ

---

æ­¤é¡µå†…å®¹

- [Redis åŸºç¡€](#redis-åŸºç¡€)
- - [ä»€ä¹ˆæ˜¯ Redisï¼Ÿ](#ä»€ä¹ˆæ˜¯-redis)
    - [Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ](#redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«)
    - [é™¤äº† Redisï¼Œä½ è¿˜çŸ¥é“å…¶ä»–åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆå—ï¼Ÿ](#é™¤äº†-redis-ä½ è¿˜çŸ¥é“å…¶ä»–åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆå—)
    - [è¯´ä¸€ä¸‹ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹](#è¯´ä¸€ä¸‹-redis-å’Œ-memcached-çš„åŒºåˆ«å’Œå…±åŒç‚¹)
    - [ä¸ºä»€ä¹ˆè¦ç”¨ Redisï¼Ÿ](#ä¸ºä»€ä¹ˆè¦ç”¨-redis)
    - [ä¸ºä»€ä¹ˆç”¨ Redis è€Œä¸ç”¨æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿ](#ä¸ºä»€ä¹ˆç”¨-redis-è€Œä¸ç”¨æœ¬åœ°ç¼“å­˜å‘¢)
    - [å¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ](#å¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰å“ªäº›)
    - [ä»€ä¹ˆæ˜¯ Redis Moduleï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ](#ä»€ä¹ˆæ˜¯-redis-module-æœ‰ä»€ä¹ˆç”¨)
- [Redis åº”ç”¨](#redis-åº”ç”¨)
- - [Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ](#redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ)
    - [å¦‚ä½•åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ](#å¦‚ä½•åŸºäº-redis-å®ç°åˆ†å¸ƒå¼é”)
    - [Redis å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ä¹ˆï¼Ÿ](#redis-å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ä¹ˆ)
    - [Redis å¯ä»¥åšæœç´¢å¼•æ“ä¹ˆï¼Ÿ](#redis-å¯ä»¥åšæœç´¢å¼•æ“ä¹ˆ)
    - [å¦‚ä½•åŸºäº Redis å®ç°å»¶æ—¶ä»»åŠ¡ï¼Ÿ](#å¦‚ä½•åŸºäº-redis-å®ç°å»¶æ—¶ä»»åŠ¡)
- [Redis æ•°æ®ç±»å‹](#redis-æ•°æ®ç±»å‹)
- - [Redis å¸¸ç”¨çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ](#redis-å¸¸ç”¨çš„æ•°æ®ç±»å‹æœ‰å“ªäº›)
    - [String çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ](#string-çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›)
    - [String è¿˜æ˜¯ Hash å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ](#string-è¿˜æ˜¯-hash-å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢)
    - [String çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼Ÿ](#string-çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ)
    - [è´­ç‰©è½¦ä¿¡æ¯ç”¨ String è¿˜æ˜¯ Hash å­˜å‚¨æ›´å¥½å‘¢?](#è´­ç‰©è½¦ä¿¡æ¯ç”¨-string-è¿˜æ˜¯-hash-å­˜å‚¨æ›´å¥½å‘¢)
    - [ä½¿ç”¨ Redis å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-redis-å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåš)
    - [Redis çš„æœ‰åºé›†åˆåº•å±‚ä¸ºä»€ä¹ˆè¦ç”¨è·³è¡¨ï¼Œè€Œä¸ç”¨å¹³è¡¡æ ‘ã€çº¢é»‘æ ‘æˆ–è€… B+ æ ‘ï¼Ÿ](#redis-çš„æœ‰åºé›†åˆåº•å±‚ä¸ºä»€ä¹ˆè¦ç”¨è·³è¡¨-è€Œä¸ç”¨å¹³è¡¡æ ‘ã€çº¢é»‘æ ‘æˆ–è€…-b-æ ‘)
    - [Set çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ](#set-çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆ)
    - [ä½¿ç”¨ Set å®ç°æŠ½å¥–ç³»ç»Ÿæ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-set-å®ç°æŠ½å¥–ç³»ç»Ÿæ€ä¹ˆåš)
    - [ä½¿ç”¨ Bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·æ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-bitmap-ç»Ÿè®¡æ´»è·ƒç”¨æˆ·æ€ä¹ˆåš)
    - [ä½¿ç”¨ HyperLogLog ç»Ÿè®¡é¡µé¢ UV æ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-hyperloglog-ç»Ÿè®¡é¡µé¢-uv-æ€ä¹ˆåš)
- [Redis æŒä¹…åŒ–æœºåˆ¶ï¼ˆé‡è¦ï¼‰](#redis-æŒä¹…åŒ–æœºåˆ¶-é‡è¦)
- [Redis çº¿ç¨‹æ¨¡å‹ï¼ˆé‡è¦ï¼‰](#redis-çº¿ç¨‹æ¨¡å‹-é‡è¦)
- - [Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ](#redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—)
    - [Redis6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ](#redis6-0-ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹)
    - [Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ](#redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹)
    - [Redis åå°çº¿ç¨‹äº†è§£å—ï¼Ÿ](#redis-åå°çº¿ç¨‹äº†è§£å—)
- [Redis å†…å­˜ç®¡ç†](#redis-å†…å­˜ç®¡ç†)
- - [Redis ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰ä»€ä¹ˆç”¨ï¼Ÿ](#redis-ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰ä»€ä¹ˆç”¨)
    - [Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ](#redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢)
    - [Redis è¿‡æœŸ key åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ](#redis-è¿‡æœŸ-key-åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ)
    - [å¤§é‡ key é›†ä¸­è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ](#å¤§é‡-key-é›†ä¸­è¿‡æœŸæ€ä¹ˆåŠ)
    - [Redis å†…å­˜æ·˜æ±°ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ](#redis-å†…å­˜æ·˜æ±°ç­–ç•¥äº†è§£ä¹ˆ)
- [å‚è€ƒ](#å‚è€ƒ)

è¿™æ˜¯ä¸€åˆ™æˆ–è®¸å¯¹ä½ æœ‰ç”¨çš„å°å¹¿å‘Š

- **é¢è¯•ä¸“ç‰ˆ**ï¼šå‡†å¤‡ Java é¢è¯•çš„å°ä¼™ä¼´å¯ä»¥è€ƒè™‘é¢è¯•ä¸“ç‰ˆï¼š**[ã€ŠJava é¢è¯•æŒ‡åŒ— ã€‹](/zhuanlan/java-mian-shi-zhi-bei.html)** (è´¨é‡éå¸¸é«˜ï¼Œä¸“ä¸ºé¢è¯•æ‰“é€ ï¼Œé…åˆ JavaGuide é£Ÿç”¨æ•ˆæœæœ€ä½³)ã€‚
- **çŸ¥è¯†æ˜Ÿçƒ**ï¼šæŠ€æœ¯ä¸“æ /ä¸€å¯¹ä¸€æé—®/ç®€å†ä¿®æ”¹/æ±‚èŒæŒ‡å—/é¢è¯•æ‰“å¡/ä¸å®šæ—¶ç¦åˆ©ï¼Œæ¬¢è¿åŠ å…¥ **[JavaGuide å®˜æ–¹çŸ¥è¯†æ˜Ÿçƒ](/about-the-author/zhishixingqiu-two-years.html)**ã€‚

## [Redis åŸºç¡€](#redis-åŸºç¡€)

### [ä»€ä¹ˆæ˜¯ Redisï¼Ÿ](#ä»€ä¹ˆæ˜¯-redis)

[Redis](https://redis.io/) ï¼ˆ**RE**mote **DI**ctionary **S**erverï¼‰æ˜¯ä¸€ä¸ªåŸºäº C è¯­è¨€å¼€å‘çš„å¼€æº NoSQL æ•°æ®åº“ï¼ˆBSD è®¸å¯ï¼‰ã€‚ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ï¼ŒRedis çš„æ•°æ®æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼ˆå†…å­˜æ•°æ®åº“ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼‰ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œè¢«å¹¿æ³›åº”ç”¨äºåˆ†å¸ƒå¼ç¼“å­˜æ–¹å‘ã€‚å¹¶ä¸”ï¼ŒRedis å­˜å‚¨çš„æ˜¯ KV é”®å€¼å¯¹æ•°æ®ã€‚

ä¸ºäº†æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒRedis å†…ç½®äº†å¤šç§æ•°æ®ç±»å‹å®ç°ï¼ˆæ¯”å¦‚ Stringã€Hashã€Sorted Setã€Bitmapã€HyperLogLogã€GEOï¼‰ã€‚å¹¶ä¸”ï¼ŒRedis è¿˜æ”¯æŒäº‹åŠ¡ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å‘å¸ƒè®¢é˜…æ¨¡å‹ã€å¤šç§å¼€ç®±å³ç”¨çš„é›†ç¾¤æ–¹æ¡ˆï¼ˆRedis Sentinelã€Redis Clusterï¼‰ã€‚

![Redis æ•°æ®ç±»å‹æ¦‚è§ˆ](https://oss.javaguide.cn/github/javaguide/database/redis/redis-overview-of-data-types-2023-09-28.jpg)

Redis æ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼ŒLinux å’Œ OS X æ˜¯ Redis å¼€å‘å’Œæµ‹è¯•æœ€å¤šçš„ä¸¤ä¸ªæ“ä½œç³»ç»Ÿï¼Œå®˜æ–¹æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Linux éƒ¨ç½² Redisã€‚

ä¸ªäººå­¦ä¹ çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±æœ¬æœºå®‰è£… Redis æˆ–è€…é€šè¿‡ Redis å®˜ç½‘æä¾›çš„[åœ¨çº¿ Redis ç¯å¢ƒ](https://try.redis.io/)ï¼ˆå°‘éƒ¨åˆ†å‘½ä»¤æ— æ³•ä½¿ç”¨ï¼‰æ¥å®é™…ä½“éªŒ Redisã€‚

![try-redis](https://oss.javaguide.cn/github/javaguide/database/redis/try.redis.io.png)

å…¨ä¸–ç•Œæœ‰éå¸¸å¤šçš„ç½‘ç«™ä½¿ç”¨åˆ°äº† Redisï¼Œ[techstacks.io](https://techstacks.io/) ä¸“é—¨ç»´æŠ¤äº†ä¸€ä¸ª[ä½¿ç”¨ Redis çš„çƒ­é—¨ç«™ç‚¹åˆ—è¡¨](https://techstacks.io/tech/redis)ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥çœ‹çœ‹ã€‚

### [Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ](#redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«)

Redis å†…éƒ¨åšäº†éå¸¸å¤šçš„æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ä¸‹é¢ 4 ç‚¹ï¼š

1. Redis åŸºäºå†…å­˜ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æ¯”ç£ç›˜å¿«å¾ˆå¤šï¼›
2. Redis åŸºäº Reactor æ¨¡å¼è®¾è®¡å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œä¸»è¦æ˜¯å•çº¿ç¨‹äº‹ä»¶å¾ªç¯å’Œ IO å¤šè·¯å¤ç”¨ï¼ˆRedis çº¿ç¨‹æ¨¡å¼åé¢ä¼šè¯¦ç»†ä»‹ç»åˆ°ï¼‰ï¼›
3. Redis å†…ç½®äº†å¤šç§ä¼˜åŒ–è¿‡åçš„æ•°æ®ç±»å‹/ç»“æ„å®ç°ï¼Œæ€§èƒ½éå¸¸é«˜ï¼›
4. Redis é€šä¿¡åè®®å®ç°ç®€å•ä¸”è§£æé«˜æ•ˆã€‚

> ä¸‹é¢è¿™å¼ å›¾ç‰‡æ€»ç»“çš„æŒºä¸é”™çš„ï¼Œåˆ†äº«ä¸€ä¸‹ï¼Œå‡ºè‡ª [Why is Redis so fast?](https://twitter.com/alexxubyte/status/1498703822528544770)ã€‚

![why-redis-so-fast](https://javaguide.cn/database/redis/redis-questions-01.html#redis-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/assets/why-redis-so-fast-TbWX24ja.png)

é‚£æ—¢ç„¶éƒ½è¿™ä¹ˆå¿«äº†ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ Redis å½“ä¸»æ•°æ®åº“å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå†…å­˜æˆæœ¬å¤ªé«˜ï¼Œå¹¶ä¸” Redis æä¾›çš„æ•°æ®æŒä¹…åŒ–ä»ç„¶æœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚

### [é™¤äº† Redisï¼Œä½ è¿˜çŸ¥é“å…¶ä»–åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆå—ï¼Ÿ](#é™¤äº†-redis-ä½ è¿˜çŸ¥é“å…¶ä»–åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆå—)

å¦‚æœé¢è¯•ä¸­è¢«é—®åˆ°è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œé¢è¯•å®˜ä¸»è¦æƒ³çœ‹çœ‹ï¼š

1. ä½ åœ¨é€‰æ‹© Redis ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆæ—¶ï¼Œæ˜¯å¦æ˜¯ç»è¿‡ä¸¥è°¨çš„è°ƒç ”å’Œæ€è€ƒï¼Œè¿˜æ˜¯åªæ˜¯å› ä¸º Redis æ˜¯å½“å‰çš„â€œçƒ­é—¨â€æŠ€æœ¯ã€‚
2. ä½ åœ¨åˆ†å¸ƒå¼ç¼“å­˜æ–¹å‘çš„æŠ€æœ¯å¹¿åº¦ã€‚

å¦‚æœä½ äº†è§£å…¶ä»–æ–¹æ¡ˆï¼Œå¹¶ä¸”èƒ½è§£é‡Šä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©äº† Redisï¼ˆæ›´è¿›ä¸€æ­¥ï¼ï¼‰ï¼Œè¿™ä¼šå¯¹ä½ é¢è¯•è¡¨ç°åŠ åˆ†ä¸å°‘ï¼

ä¸‹é¢ç®€å•èŠèŠå¸¸è§çš„åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹ã€‚

åˆ†å¸ƒå¼ç¼“å­˜çš„è¯ï¼Œæ¯”è¾ƒè€ç‰ŒåŒæ—¶ä¹Ÿæ˜¯ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„è¿˜æ˜¯ **Memcached** å’Œ **Redis**ã€‚ä¸è¿‡ï¼Œç°åœ¨åŸºæœ¬æ²¡æœ‰çœ‹è¿‡è¿˜æœ‰é¡¹ç›®ä½¿ç”¨ **Memcached** æ¥åšç¼“å­˜ï¼Œéƒ½æ˜¯ç›´æ¥ç”¨ **Redis**ã€‚

Memcached æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æœ€å¼€å§‹å…´èµ·çš„é‚£ä¼šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ã€‚åæ¥ï¼Œéšç€ Redis çš„å‘å±•ï¼Œå¤§å®¶æ…¢æ…¢éƒ½è½¬è€Œä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ Redis äº†ã€‚

æœ‰ä¸€äº›å¤§å‚ä¹Ÿå¼€æºäº†ç±»ä¼¼äº Redis çš„åˆ†å¸ƒå¼é«˜æ€§èƒ½ KV å­˜å‚¨æ•°æ®åº“ï¼Œä¾‹å¦‚ï¼Œè…¾è®¯å¼€æºçš„ [**Tendis**](https://github.com/Tencent/Tendis)ã€‚Tendis åŸºäºçŸ¥åå¼€æºé¡¹ç›® [RocksDB](https://github.com/facebook/rocksdb) ä½œä¸ºå­˜å‚¨å¼•æ“ ï¼Œ100% å…¼å®¹ Redis åè®®å’Œ Redis4.0 æ‰€æœ‰æ•°æ®æ¨¡å‹ã€‚å…³äº Redis å’Œ Tendis çš„å¯¹æ¯”ï¼Œè…¾è®¯å®˜æ–¹æ›¾ç»å‘è¿‡ä¸€ç¯‡æ–‡ç« ï¼š[Redis vs Tendisï¼šå†·çƒ­æ··åˆå­˜å‚¨ç‰ˆæ¶æ„æ­ç§˜](https://mp.weixin.qq.com/s/MeYkfOIdnU6LYlsGb24KjQ)ï¼Œå¯ä»¥ç®€å•å‚è€ƒä¸€ä¸‹ã€‚

ä¸è¿‡ï¼Œä» Tendis è¿™ä¸ªé¡¹ç›®çš„ Github æäº¤è®°å½•å¯ä»¥çœ‹å‡ºï¼ŒTendis å¼€æºç‰ˆå‡ ä¹å·²ç»æ²¡æœ‰è¢«ç»´æŠ¤æ›´æ–°äº†ï¼ŒåŠ ä¸Šå…¶å…³æ³¨åº¦å¹¶ä¸é«˜ï¼Œä½¿ç”¨çš„å…¬å¸ä¹Ÿæ¯”è¾ƒå°‘ã€‚å› æ­¤ï¼Œä¸å»ºè®®ä½ ä½¿ç”¨ Tendis æ¥å®ç°åˆ†å¸ƒå¼ç¼“å­˜ã€‚

ç›®å‰ï¼Œæ¯”è¾ƒä¸šç•Œè®¤å¯çš„ Redis æ›¿ä»£å“è¿˜æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªå¼€æºåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆéƒ½æ˜¯é€šè¿‡ç¢°ç“· Redis ç«çš„ï¼‰ï¼š

- [Dragonfly](https://github.com/dragonflydb/dragonfly)ï¼šä¸€ç§é’ˆå¯¹ç°ä»£åº”ç”¨ç¨‹åºè´Ÿè·éœ€æ±‚è€Œæ„å»ºçš„å†…å­˜æ•°æ®åº“ï¼Œå®Œå…¨å…¼å®¹ Redis å’Œ Memcached çš„ APIï¼Œè¿ç§»æ—¶æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œå·ç§°å…¨ä¸–ç•Œæœ€å¿«çš„å†…å­˜æ•°æ®åº“ã€‚
- [KeyDB](https://github.com/Snapchat/KeyDB)ï¼šRedis çš„ä¸€ä¸ªé«˜æ€§èƒ½åˆ†æ”¯ï¼Œä¸“æ³¨äºå¤šçº¿ç¨‹ã€å†…å­˜æ•ˆç‡å’Œé«˜ååé‡ã€‚

ä¸è¿‡ï¼Œä¸ªäººè¿˜æ˜¯å»ºè®®åˆ†å¸ƒå¼ç¼“å­˜é¦–é€‰ Redisï¼Œæ¯•ç«Ÿç»è¿‡äº†è¿™ä¹ˆå¤šå¹´çš„è€ƒéªŒï¼Œç”Ÿæ€éå¸¸ä¼˜ç§€ï¼Œèµ„æ–™ä¹Ÿå¾ˆå…¨é¢ï¼

PSï¼šç¯‡å¹…é—®é¢˜ï¼Œæˆ‘è¿™å¹¶æ²¡æœ‰å¯¹ä¸Šé¢æåˆ°çš„åˆ†å¸ƒå¼ç¼“å­˜é€‰å‹åšè¯¦ç»†ä»‹ç»å’Œå¯¹æ¯”ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚

### [è¯´ä¸€ä¸‹ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹](#è¯´ä¸€ä¸‹-redis-å’Œ-memcached-çš„åŒºåˆ«å’Œå…±åŒç‚¹)

ç°åœ¨å…¬å¸ä¸€èˆ¬éƒ½æ˜¯ç”¨ Redis æ¥å®ç°ç¼“å­˜ï¼Œè€Œä¸” Redis è‡ªèº«ä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ï¼ä¸è¿‡ï¼Œäº†è§£ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨åšç›¸åº”çš„æŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œèƒ½å¤Ÿåšåˆ°æœ‰ç†æœ‰æ®ï¼

**å…±åŒç‚¹**ï¼š

1. éƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚
2. éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚
3. ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚

**åŒºåˆ«**ï¼š

1. **æ•°æ®ç±»å‹**ï¼šRedis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰ã€‚Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ k/v ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listã€setã€zsetã€hash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ï¼›è€Œ Memcached åªæ”¯æŒæœ€ç®€å•çš„ k/v æ•°æ®ç±»å‹ã€‚
2. **æ•°æ®æŒä¹…åŒ–**ï¼šRedis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ï¼›è€Œ Memcached æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRedis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ï¼Œè€Œ Memcached æ²¡æœ‰ã€‚
3. **é›†ç¾¤æ¨¡å¼æ”¯æŒ**ï¼šMemcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›è€Œ Redis è‡ª 3.0 ç‰ˆæœ¬èµ·æ˜¯åŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼çš„ã€‚
4. **çº¿ç¨‹æ¨¡å‹**ï¼šMemcached æ˜¯å¤šçº¿ç¨‹ã€éé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›è€Œ Redis ä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ï¼ˆRedis 6.0 é’ˆå¯¹ç½‘ç»œæ•°æ®çš„è¯»å†™å¼•å…¥äº†å¤šçº¿ç¨‹ï¼‰ã€‚
5. **ç‰¹æ€§æ”¯æŒ**ï¼šRedis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼ŒRedis æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚
6. **è¿‡æœŸæ•°æ®åˆ é™¤**ï¼šMemcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ï¼Œè€Œ Redis åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ã€‚

ç›¸ä¿¡çœ‹äº†ä¸Šé¢çš„å¯¹æ¯”ä¹‹åï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰ä»€ä¹ˆç†ç”±å¯ä»¥é€‰æ‹©ä½¿ç”¨ Memcached æ¥ä½œä¸ºè‡ªå·±é¡¹ç›®çš„åˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚

### [ä¸ºä»€ä¹ˆè¦ç”¨ Redisï¼Ÿ](#ä¸ºä»€ä¹ˆè¦ç”¨-redis)

**1ã€è®¿é—®é€Ÿåº¦æ›´å¿«**

ä¼ ç»Ÿæ•°æ®åº“æ•°æ®ä¿å­˜åœ¨ç£ç›˜ï¼Œè€Œ Redis åŸºäºå†…å­˜ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æ¯”ç£ç›˜å¿«å¾ˆå¤šã€‚å¼•å…¥ Redis ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›é«˜é¢‘è®¿é—®çš„æ•°æ®æ”¾åˆ° Redis ä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥ä»å†…å­˜ä¸­è¯»å–ï¼Œé€Ÿåº¦å¯ä»¥æå‡å‡ åå€ç”šè‡³ä¸Šç™¾å€ã€‚

**2ã€é«˜å¹¶å‘**

ä¸€èˆ¬åƒ MySQL è¿™ç±»çš„æ•°æ®åº“çš„ QPS å¤§æ¦‚éƒ½åœ¨ 4k å·¦å³ï¼ˆ4 æ ¸ 8gï¼‰ï¼Œä½†æ˜¯ä½¿ç”¨ Redis ç¼“å­˜ä¹‹åå¾ˆå®¹æ˜“è¾¾åˆ° 5w+ï¼Œç”šè‡³èƒ½è¾¾åˆ° 10w+ï¼ˆå°±å•æœº Redis çš„æƒ…å†µï¼ŒRedis é›†ç¾¤çš„è¯ä¼šæ›´é«˜ï¼‰ã€‚

> QPSï¼ˆQuery Per Secondï¼‰ï¼šæœåŠ¡å™¨æ¯ç§’å¯ä»¥æ‰§è¡Œçš„æŸ¥è¯¢æ¬¡æ•°ï¼›

ç”±æ­¤å¯è§ï¼Œç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„æ•°æ®åº“è¯·æ±‚æ•°é‡æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚è¿›è€Œï¼Œæˆ‘ä»¬ä¹Ÿå°±æé«˜äº†ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘ã€‚

**3ã€åŠŸèƒ½å…¨é¢**

Redis é™¤äº†å¯ä»¥ç”¨ä½œç¼“å­˜ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ†å¸ƒå¼é”ã€é™æµã€æ¶ˆæ¯é˜Ÿåˆ—ã€å»¶æ—¶é˜Ÿåˆ—ç­‰åœºæ™¯ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼

### [ä¸ºä»€ä¹ˆç”¨ Redis è€Œä¸ç”¨æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿ](#ä¸ºä»€ä¹ˆç”¨-redis-è€Œä¸ç”¨æœ¬åœ°ç¼“å­˜å‘¢)

|ç‰¹æ€§|æœ¬åœ°ç¼“å­˜|Redis|
|---|---|---|
|æ•°æ®ä¸€è‡´æ€§|å¤šæœåŠ¡å™¨éƒ¨ç½²æ—¶å­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜|æ•°æ®ä¸€è‡´|
|å†…å­˜é™åˆ¶|å—é™äºå•å°æœåŠ¡å™¨å†…å­˜|ç‹¬ç«‹éƒ¨ç½²ï¼Œå†…å­˜ç©ºé—´æ›´å¤§|
|æ•°æ®ä¸¢å¤±é£é™©|æœåŠ¡å™¨å®•æœºæ•°æ®ä¸¢å¤±|å¯æŒä¹…åŒ–ï¼Œæ•°æ®ä¸æ˜“ä¸¢å¤±|
|ç®¡ç†ç»´æŠ¤|åˆ†æ•£ï¼Œç®¡ç†ä¸ä¾¿|é›†ä¸­ç®¡ç†ï¼Œæä¾›ä¸°å¯Œçš„ç®¡ç†å·¥å…·|
|åŠŸèƒ½ä¸°å¯Œæ€§|åŠŸèƒ½æœ‰é™ï¼Œé€šå¸¸åªæä¾›ç®€å•çš„é”®å€¼å¯¹å­˜å‚¨|åŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’ŒåŠŸèƒ½|

### [å¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ](#å¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰å“ªäº›)

å…³äºå¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[3 ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥è¯¦è§£](https://javaguide.cn/database/redis/3-commonly-used-cache-read-and-write-strategies.html)ã€‚

### [ä»€ä¹ˆæ˜¯ Redis Moduleï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ](#ä»€ä¹ˆæ˜¯-redis-module-æœ‰ä»€ä¹ˆç”¨)

Redis ä» 4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒé€šè¿‡ Module æ¥æ‰©å±•å…¶åŠŸèƒ½ä»¥æ»¡è¶³ç‰¹æ®Šçš„éœ€æ±‚ã€‚è¿™äº› Module ä»¥åŠ¨æ€é“¾æ¥åº“ï¼ˆso æ–‡ä»¶ï¼‰çš„å½¢å¼è¢«åŠ è½½åˆ° Redis ä¸­ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸çµæ´»çš„åŠ¨æ€æ‰©å±•åŠŸèƒ½çš„å®ç°æ–¹å¼ï¼Œå€¼å¾—å€Ÿé‰´å­¦ä¹ ï¼

æˆ‘ä»¬æ¯ä¸ªäººéƒ½å¯ä»¥åŸºäº Redis å»å®šåˆ¶åŒ–å¼€å‘è‡ªå·±çš„ Moduleï¼Œæ¯”å¦‚å®ç°æœç´¢å¼•æ“åŠŸèƒ½ã€è‡ªå®šä¹‰åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é™æµã€‚

ç›®å‰ï¼Œè¢« Redis å®˜æ–¹æ¨èçš„ Module æœ‰ï¼š

- [RediSearch](https://github.com/RediSearch/RediSearch)ï¼šç”¨äºå®ç°æœç´¢å¼•æ“çš„æ¨¡å—ã€‚
- [RedisJSON](https://github.com/RedisJSON/RedisJSON)ï¼šç”¨äºå¤„ç† JSON æ•°æ®çš„æ¨¡å—ã€‚
- [RedisGraph](https://github.com/RedisGraph/RedisGraph)ï¼šç”¨äºå®ç°å›¾å½¢æ•°æ®åº“çš„æ¨¡å—ã€‚
- [RedisTimeSeries](https://github.com/RedisTimeSeries/RedisTimeSeries)ï¼šç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®çš„æ¨¡å—ã€‚
- [RedisBloom](https://github.com/RedisBloom/RedisBloom)ï¼šç”¨äºå®ç°å¸ƒéš†è¿‡æ»¤å™¨çš„æ¨¡å—ã€‚
- [RedisAI](https://github.com/RedisAI/RedisAI)ï¼šç”¨äºæ‰§è¡Œæ·±åº¦å­¦ä¹ /æœºå™¨å­¦ä¹ æ¨¡å‹å¹¶ç®¡ç†å…¶æ•°æ®çš„æ¨¡å—ã€‚
- [RedisCell](https://github.com/brandur/redis-cell)ï¼šç”¨äºå®ç°åˆ†å¸ƒå¼é™æµçš„æ¨¡å—ã€‚
- â€¦â€¦

å…³äº Redis æ¨¡å—çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š[https://redis.io/modules](https://redis.io/modules)ã€‚

## [Redis åº”ç”¨](#redis-åº”ç”¨)

### [Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ](#redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ)

- **åˆ†å¸ƒå¼é”**ï¼šé€šè¿‡ Redis æ¥åšåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäº Redisson æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚å…³äº Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[åˆ†å¸ƒå¼é”è¯¦è§£](https://javaguide.cn/distributed-system/distributed-lock.html)ã€‚
- **é™æµ**ï¼šä¸€èˆ¬æ˜¯é€šè¿‡ Redis + Lua è„šæœ¬çš„æ–¹å¼æ¥å®ç°é™æµã€‚å¦‚æœä¸æƒ³è‡ªå·±å†™ Lua è„šæœ¬çš„è¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨ Redisson ä¸­çš„ `RRateLimiter` æ¥å®ç°åˆ†å¸ƒå¼é™æµï¼Œå…¶åº•å±‚å®ç°å°±æ˜¯åŸºäº Lua ä»£ç +ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRedis è‡ªå¸¦çš„ List æ•°æ®ç»“æ„å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ä½¿ç”¨ã€‚Redis 5.0 ä¸­å¢åŠ çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´åŠ é€‚åˆç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒæ¯”è¾ƒç±»ä¼¼äº Kafkaï¼Œæœ‰ä¸»é¢˜å’Œæ¶ˆè´¹ç»„çš„æ¦‚å¿µï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠ ACK æœºåˆ¶ã€‚
- **å»¶æ—¶é˜Ÿåˆ—**ï¼šRedisson å†…ç½®äº†å»¶æ—¶é˜Ÿåˆ—ï¼ˆåŸºäº Sorted Set å®ç°çš„ï¼‰ã€‚
- **åˆ†å¸ƒå¼ Session**ï¼šåˆ©ç”¨ String æˆ–è€… Hash æ•°æ®ç±»å‹ä¿å­˜ Session æ•°æ®ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å¯ä»¥è®¿é—®ã€‚
- **å¤æ‚ä¸šåŠ¡åœºæ™¯**ï¼šé€šè¿‡ Redis ä»¥åŠ Redis æ‰©å±•ï¼ˆæ¯”å¦‚ Redissonï¼‰æä¾›çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚é€šè¿‡ Bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ã€é€šè¿‡ Sorted Set ç»´æŠ¤æ’è¡Œæ¦œã€é€šè¿‡ HyperLogLog ç»Ÿè®¡ç½‘ç«™ UV å’Œ PVã€‚
- â€¦â€¦

### [å¦‚ä½•åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ](#å¦‚ä½•åŸºäº-redis-å®ç°åˆ†å¸ƒå¼é”)

å…³äº Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[åˆ†å¸ƒå¼é”è¯¦è§£](https://javaguide.cn/distributed-system/distributed-lock-implementations.html)ã€‚

### [Redis å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ä¹ˆï¼Ÿ](#redis-å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ä¹ˆ)

> å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—çš„éå¸¸å°‘ï¼Œæ¯•ç«Ÿæœ‰æ›´æˆç†Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶å¯ä»¥ç”¨ã€‚

å…ˆè¯´ç»“è®ºï¼š**å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸å»ºè®®ä½¿ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ¬ ç¼ºçš„åœ°æ–¹ã€‚**

**Redis 2.0 ä¹‹å‰ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—çš„è¯ï¼Œåªèƒ½é€šè¿‡ List æ¥å®ç°ã€‚**

é€šè¿‡ `RPUSH/LPOP` æˆ–è€… `LPUSH/RPOP` å³å¯å®ç°ç®€æ˜“ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼š

```
# ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯
> RPUSH myList msg1 msg2
(integer) 2
> RPUSH myList msg3
(integer) 3
# æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
> LPOP myList
"msg1"
```

ä¸è¿‡ï¼Œé€šè¿‡ `RPUSH/LPOP` æˆ–è€… `LPUSH/RPOP` è¿™æ ·çš„æ–¹å¼å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸æ–­è½®è¯¢å»è°ƒç”¨ `RPOP` æˆ– `LPOP` æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ List ä¸ºç©ºæ—¶ï¼Œå¤§éƒ¨åˆ†çš„è½®è¯¢çš„è¯·æ±‚éƒ½æ˜¯æ— æ•ˆè¯·æ±‚ï¼Œè¿™ç§æ–¹å¼å¤§é‡æµªè´¹äº†ç³»ç»Ÿèµ„æºã€‚

å› æ­¤ï¼ŒRedis è¿˜æä¾›äº† `BLPOP`ã€`BRPOP` è¿™ç§é˜»å¡å¼è¯»å–çš„å‘½ä»¤ï¼ˆå¸¦ B-Blocking çš„éƒ½æ˜¯é˜»å¡å¼ï¼‰ï¼Œå¹¶ä¸”è¿˜æ”¯æŒä¸€ä¸ªè¶…æ—¶å‚æ•°ã€‚å¦‚æœ List ä¸ºç©ºï¼ŒRedis æœåŠ¡ç«¯ä¸ä¼šç«‹åˆ»è¿”å›ç»“æœï¼Œå®ƒä¼šç­‰å¾… List ä¸­æœ‰æ–°æ•°æ®åå†è¿”å›æˆ–è€…æ˜¯ç­‰å¾…æœ€å¤šä¸€ä¸ªè¶…æ—¶æ—¶é—´åè¿”å›ç©ºã€‚å¦‚æœå°†è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 0 æ—¶ï¼Œå³å¯æ— é™ç­‰å¾…ï¼Œç›´åˆ°å¼¹å‡ºæ¶ˆæ¯

```
# è¶…æ—¶æ—¶é—´ä¸º 10s
# å¦‚æœæœ‰æ•°æ®ç«‹åˆ»è¿”å›ï¼Œå¦åˆ™æœ€å¤šç­‰å¾…10ç§’
> BRPOP myList 10
null
```

**List å®ç°æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½å¤ªç®€å•ï¼Œåƒæ¶ˆæ¯ç¡®è®¤æœºåˆ¶ç­‰åŠŸèƒ½è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæœ€è¦å‘½çš„æ˜¯æ²¡æœ‰å¹¿æ’­æœºåˆ¶ï¼Œæ¶ˆæ¯ä¹Ÿåªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚**

**Redis 2.0 å¼•å…¥äº†å‘å¸ƒè®¢é˜… (pub/sub) åŠŸèƒ½ï¼Œè§£å†³äº† List å®ç°æ¶ˆæ¯é˜Ÿåˆ—æ²¡æœ‰å¹¿æ’­æœºåˆ¶çš„é—®é¢˜ã€‚**

![Redis å‘å¸ƒè®¢é˜… (pub/sub) åŠŸèƒ½](https://oss.javaguide.cn/github/javaguide/database/redis/redis-pub-sub.png)

pub/sub ä¸­å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µå« **channelï¼ˆé¢‘é“ï¼‰**ï¼Œå‘å¸ƒè®¢é˜…æœºåˆ¶çš„å®ç°å°±æ˜¯åŸºäºè¿™ä¸ª channel æ¥åšçš„ã€‚

pub/sub æ¶‰åŠå‘å¸ƒè€…ï¼ˆPublisherï¼‰å’Œè®¢é˜…è€…ï¼ˆSubscriberï¼Œä¹Ÿå«æ¶ˆè´¹è€…ï¼‰ä¸¤ä¸ªè§’è‰²ï¼š

- å‘å¸ƒè€…é€šè¿‡ `PUBLISH` æŠ•é€’æ¶ˆæ¯ç»™æŒ‡å®š channelã€‚
- è®¢é˜…è€…é€šè¿‡`SUBSCRIBE`è®¢é˜…å®ƒå…³å¿ƒçš„ channelã€‚å¹¶ä¸”ï¼Œè®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ª channelã€‚

æˆ‘ä»¬è¿™é‡Œå¯åŠ¨ 3 ä¸ª Redis å®¢æˆ·ç«¯æ¥ç®€å•æ¼”ç¤ºä¸€ä¸‹ï¼š

![pub/sub å®ç°æ¶ˆæ¯é˜Ÿåˆ—æ¼”ç¤º](https://oss.javaguide.cn/github/javaguide/database/redis/redis-pubsub-message-queue.png)

pub/sub æ—¢èƒ½å•æ’­åˆèƒ½å¹¿æ’­ï¼Œè¿˜æ”¯æŒ channel çš„ç®€å•æ­£åˆ™åŒ¹é…ã€‚ä¸è¿‡ï¼Œæ¶ˆæ¯ä¸¢å¤±ï¼ˆå®¢æˆ·ç«¯æ–­å¼€è¿æ¥æˆ–è€… Redis å®•æœºéƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€æ¶ˆæ¯å †ç§¯ï¼ˆå‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™ä¸ä¼šç®¡æ¶ˆè´¹è€…çš„å…·ä½“æ¶ˆè´¹èƒ½åŠ›å¦‚ä½•ï¼‰ç­‰é—®é¢˜ä¾ç„¶æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è§£å†³åŠæ³•ã€‚

ä¸ºæ­¤ï¼ŒRedis 5.0 æ–°å¢åŠ çš„ä¸€ä¸ªæ•°æ®ç»“æ„ `Stream` æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚`Stream` æ”¯æŒï¼š

- å‘å¸ƒ / è®¢é˜…æ¨¡å¼ï¼›
- æŒ‰ç…§æ¶ˆè´¹è€…ç»„è¿›è¡Œæ¶ˆè´¹ï¼ˆå€Ÿé‰´äº† Kafka æ¶ˆè´¹è€…ç»„çš„æ¦‚å¿µï¼‰ï¼›
- æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆ RDB å’Œ AOFï¼‰ï¼›
- ACK æœºåˆ¶ï¼ˆé€šè¿‡ç¡®è®¤æœºåˆ¶æ¥å‘ŠçŸ¥å·²ç»æˆåŠŸå¤„ç†äº†æ¶ˆæ¯ï¼‰ï¼›
- é˜»å¡å¼è·å–æ¶ˆæ¯ã€‚

`Stream` çš„ç»“æ„å¦‚ä¸‹ï¼š

![](https://oss.javaguide.cn/github/javaguide/database/redis/redis-stream-structure.png)

è¿™æ˜¯ä¸€ä¸ªæœ‰åºçš„æ¶ˆæ¯é“¾è¡¨ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ ID å’Œå¯¹åº”çš„å†…å®¹ã€‚ID æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³å’Œåºåˆ—å·çš„ç»„åˆï¼Œç”¨æ¥ä¿è¯æ¶ˆæ¯çš„å”¯ä¸€æ€§å’Œé€’å¢æ€§ã€‚å†…å®¹æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹ï¼ˆç±»ä¼¼ Hash åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ï¼Œç”¨æ¥å­˜å‚¨æ¶ˆæ¯çš„æ•°æ®ã€‚

è¿™é‡Œå†å¯¹å›¾ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›æ¦‚å¿µï¼Œè¿›è¡Œç®€å•è§£é‡Šï¼š

- `Consumer Group`ï¼šæ¶ˆè´¹è€…ç»„ç”¨äºç»„ç»‡å’Œç®¡ç†å¤šä¸ªæ¶ˆè´¹è€…ã€‚æ¶ˆè´¹è€…ç»„æœ¬èº«ä¸å¤„ç†æ¶ˆæ¯ï¼Œè€Œæ˜¯å†å°†æ¶ˆæ¯åˆ†å‘ç»™æ¶ˆè´¹è€…ï¼Œç”±æ¶ˆè´¹è€…è¿›è¡ŒçœŸæ­£çš„æ¶ˆè´¹ã€‚
- `last_delivered_id`ï¼šæ ‡è¯†æ¶ˆè´¹è€…ç»„å½“å‰æ¶ˆè´¹ä½ç½®çš„æ¸¸æ ‡ï¼Œæ¶ˆè´¹è€…ç»„ä¸­ä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…è¯»å–äº†æ¶ˆæ¯éƒ½ä¼šä½¿ last_delivered_id å¾€å‰ç§»åŠ¨ã€‚
- `pending_ids`ï¼šè®°å½•å·²ç»è¢«å®¢æˆ·ç«¯æ¶ˆè´¹ä½†æ²¡æœ‰ ack çš„æ¶ˆæ¯çš„ IDã€‚

ä¸‹é¢æ˜¯`Stream` ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—æ—¶å¸¸ç”¨çš„å‘½ä»¤ï¼š

- `XADD`ï¼šå‘æµä¸­æ·»åŠ æ–°çš„æ¶ˆæ¯ã€‚
- `XREAD`ï¼šä»æµä¸­è¯»å–æ¶ˆæ¯ã€‚
- `XREADGROUP`ï¼šä»æ¶ˆè´¹ç»„ä¸­è¯»å–æ¶ˆæ¯ã€‚
- `XRANGE`ï¼šæ ¹æ®æ¶ˆæ¯ ID èŒƒå›´è¯»å–æµä¸­çš„æ¶ˆæ¯ã€‚
- `XREVRANGE`ï¼šä¸ `XRANGE` ç±»ä¼¼ï¼Œä½†ä»¥ç›¸åé¡ºåºè¿”å›ç»“æœã€‚
- `XDEL`ï¼šä»æµä¸­åˆ é™¤æ¶ˆæ¯ã€‚
- `XTRIM`ï¼šä¿®å‰ªæµçš„é•¿åº¦ï¼Œå¯ä»¥æŒ‡å®šä¿®å»ºç­–ç•¥ï¼ˆ`MAXLEN`/`MINID`ï¼‰ã€‚
- `XLEN`ï¼šè·å–æµçš„é•¿åº¦ã€‚
- `XGROUP CREATE`ï¼šåˆ›å»ºæ¶ˆè´¹è€…ç»„ã€‚
- `XGROUP DESTROY`ï¼šåˆ é™¤æ¶ˆè´¹è€…ç»„ã€‚
- `XGROUP DELCONSUMER`ï¼šä»æ¶ˆè´¹è€…ç»„ä¸­åˆ é™¤ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚
- `XGROUP SETID`ï¼šä¸ºæ¶ˆè´¹è€…ç»„è®¾ç½®æ–°çš„æœ€åé€’é€æ¶ˆæ¯ IDã€‚
- `XACK`ï¼šç¡®è®¤æ¶ˆè´¹ç»„ä¸­çš„æ¶ˆæ¯å·²è¢«å¤„ç†ã€‚
- `XPENDING`ï¼šæŸ¥è¯¢æ¶ˆè´¹ç»„ä¸­æŒ‚èµ·ï¼ˆæœªç¡®è®¤ï¼‰çš„æ¶ˆæ¯ã€‚
- `XCLAIM`ï¼šå°†æŒ‚èµ·çš„æ¶ˆæ¯ä»ä¸€ä¸ªæ¶ˆè´¹è€…è½¬ç§»åˆ°å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚
- `XINFO`ï¼šè·å–æµï¼ˆ`XINFO STREAM`ï¼‰ã€æ¶ˆè´¹ç»„ï¼ˆ`XINFO GROUPS`ï¼‰æˆ–æ¶ˆè´¹è€…ï¼ˆ`XINFO CONSUMERS`ï¼‰çš„è¯¦ç»†ä¿¡æ¯ã€‚

`Stream` ä½¿ç”¨èµ·æ¥ç›¸å¯¹è¦éº»çƒ¦ä¸€äº›ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚

æ€»çš„æ¥è¯´ï¼Œ`Stream` å·²ç»å¯ä»¥æ»¡è¶³ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬è¦æ±‚äº†ã€‚ä¸è¿‡ï¼Œ`Stream` åœ¨å®é™…ä½¿ç”¨ä¸­ä¾ç„¶ä¼šæœ‰ä¸€äº›å°é—®é¢˜ä¸å¤ªå¥½è§£å†³ï¼Œæ¯”å¦‚åœ¨ Redis å‘ç”Ÿæ•…éšœæ¢å¤åä¸èƒ½ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚

ç»¼ä¸Šï¼Œå’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼Œä½¿ç”¨ Redis æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—è¿˜æ˜¯æœ‰å¾ˆå¤šæ¬ ç¼ºçš„åœ°æ–¹ï¼Œæ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±å’Œå †ç§¯é—®é¢˜ä¸å¥½è§£å†³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸å»ºè®®ä¸è¦ä½¿ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½ å®Œå…¨å¯ä»¥é€‰æ‹©å¸‚é¢ä¸Šæ¯”è¾ƒæˆç†Ÿçš„ä¸€äº›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ RocketMQã€Kafkaã€‚ä¸è¿‡ï¼Œå¦‚æœä½ å°±æ˜¯æƒ³è¦ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—çš„è¯ï¼Œé‚£æˆ‘å»ºè®®ä½ ä¼˜å…ˆè€ƒè™‘ `Stream`ï¼Œè¿™æ˜¯ç›®å‰ç›¸å¯¹æœ€ä¼˜çš„ Redis æ¶ˆæ¯é˜Ÿåˆ—å®ç°ã€‚

ç›¸å…³é˜…è¯»ï¼š[Redis æ¶ˆæ¯é˜Ÿåˆ—å‘å±•å†ç¨‹ - é˜¿é‡Œå¼€å‘è€… - 2022](https://mp.weixin.qq.com/s/gCUT5TcCQRAxYkTJfTRjJw)ã€‚

### [Redis å¯ä»¥åšæœç´¢å¼•æ“ä¹ˆï¼Ÿ](#redis-å¯ä»¥åšæœç´¢å¼•æ“ä¹ˆ)

Redis æ˜¯å¯ä»¥å®ç°å…¨æ–‡æœç´¢å¼•æ“åŠŸèƒ½çš„ï¼Œéœ€è¦å€ŸåŠ© **RediSearch**ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº Redis çš„æœç´¢å¼•æ“æ¨¡å—ã€‚

RediSearch æ”¯æŒä¸­æ–‡åˆ†è¯ã€èšåˆç»Ÿè®¡ã€åœç”¨è¯ã€åŒä¹‰è¯ã€æ‹¼å†™æ£€æŸ¥ã€æ ‡ç­¾æŸ¥è¯¢ã€å‘é‡ç›¸ä¼¼åº¦æŸ¥è¯¢ã€å¤šå…³é”®è¯æœç´¢ã€åˆ†é¡µæœç´¢ç­‰åŠŸèƒ½ï¼Œç®—æ˜¯ä¸€ä¸ªåŠŸèƒ½æ¯”è¾ƒå®Œå–„çš„å…¨æ–‡æœç´¢å¼•æ“äº†ã€‚

ç›¸æ¯”è¾ƒäº Elasticsearch æ¥è¯´ï¼ŒRediSearch ä¸»è¦åœ¨ä¸‹é¢ä¸¤ç‚¹ä¸Šè¡¨ç°æ›´ä¼˜å¼‚ä¸€äº›ï¼š

1. æ€§èƒ½æ›´ä¼˜ç§€ï¼šä¾èµ– Redis è‡ªèº«çš„é«˜æ€§èƒ½ï¼ŒåŸºäºå†…å­˜æ“ä½œï¼ˆElasticsearch åŸºäºç£ç›˜ï¼‰ã€‚
2. è¾ƒä½å†…å­˜å ç”¨å®ç°å¿«é€Ÿç´¢å¼•ï¼šRediSearch å†…éƒ¨ä½¿ç”¨å‹ç¼©çš„å€’æ’ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥ç”¨è¾ƒä½çš„å†…å­˜å ç”¨æ¥å®ç°ç´¢å¼•çš„å¿«é€Ÿæ„å»ºã€‚

å¯¹äºå°å‹é¡¹ç›®çš„ç®€å•æœç´¢åœºæ™¯æ¥è¯´ï¼Œä½¿ç”¨ RediSearch æ¥ä½œä¸ºæœç´¢å¼•æ“è¿˜æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ˆæ­é… RedisJSON ä½¿ç”¨ï¼‰ã€‚

å¯¹äºæ¯”è¾ƒå¤æ‚æˆ–è€…æ•°æ®è§„æ¨¡è¾ƒå¤§çš„æœç´¢åœºæ™¯ï¼Œè¿˜æ˜¯ä¸å¤ªå»ºè®®ä½¿ç”¨ RediSearch æ¥ä½œä¸ºæœç´¢å¼•æ“ï¼Œä¸»è¦æ˜¯å› ä¸ºä¸‹é¢è¿™äº›é™åˆ¶å’Œé—®é¢˜ï¼š

1. æ•°æ®é‡é™åˆ¶ï¼šElasticsearch å¯ä»¥æ”¯æŒ PB çº§åˆ«çš„æ•°æ®é‡ï¼Œå¯ä»¥è½»æ¾æ‰©å±•åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œåˆ©ç”¨åˆ†ç‰‡æœºåˆ¶æé«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚RedisSearch æ˜¯åŸºäº Redis å®ç°çš„ï¼Œå…¶èƒ½å­˜å‚¨çš„æ•°æ®é‡å—é™äº Redis çš„å†…å­˜å®¹é‡ï¼Œä¸å¤ªé€‚åˆå­˜å‚¨å¤§è§„æ¨¡çš„æ•°æ®ï¼ˆå†…å­˜æ˜‚è´µï¼Œæ‰©å±•èƒ½åŠ›è¾ƒå·®ï¼‰ã€‚
2. åˆ†å¸ƒå¼èƒ½åŠ›è¾ƒå·®ï¼šElasticsearch æ˜¯ä¸ºåˆ†å¸ƒå¼ç¯å¢ƒè®¾è®¡çš„ï¼Œå¯ä»¥è½»æ¾æ‰©å±•åˆ°å¤šä¸ªèŠ‚ç‚¹ã€‚è™½ç„¶ RedisSearch æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å¯èƒ½ä¼šé¢ä¸´ä¸€äº›æŒ‘æˆ˜ï¼Œå¦‚æ•°æ®åˆ†ç‰‡ã€èŠ‚ç‚¹é—´é€šä¿¡ã€æ•°æ®ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚
3. èšåˆåŠŸèƒ½è¾ƒå¼±ï¼šElasticsearch æä¾›äº†ä¸°å¯Œçš„èšåˆåŠŸèƒ½ï¼Œè€Œ RediSearch çš„èšåˆåŠŸèƒ½ç›¸å¯¹è¾ƒå¼±ï¼Œåªæ”¯æŒç®€å•çš„èšåˆæ“ä½œã€‚
4. ç”Ÿæ€è¾ƒå·®ï¼šElasticsearch å¯ä»¥è½»æ¾å’Œå¸¸è§çš„ä¸€äº›ç³»ç»Ÿ/è½¯ä»¶é›†æˆæ¯”å¦‚ Hadoopã€Sparkã€Kibanaï¼Œè€Œ RedisSearch åˆ™ä¸å…·å¤‡è¯¥ä¼˜åŠ¿ã€‚

Elasticsearch é€‚ç”¨äºå…¨æ–‡æœç´¢ã€å¤æ‚æŸ¥è¯¢ã€å®æ—¶æ•°æ®åˆ†æå’Œèšåˆçš„åœºæ™¯ï¼Œè€Œ RediSearch é€‚ç”¨äºå¿«é€Ÿæ•°æ®å­˜å‚¨ã€ç¼“å­˜å’Œç®€å•æŸ¥è¯¢çš„åœºæ™¯ã€‚

### [å¦‚ä½•åŸºäº Redis å®ç°å»¶æ—¶ä»»åŠ¡ï¼Ÿ](#å¦‚ä½•åŸºäº-redis-å®ç°å»¶æ—¶ä»»åŠ¡)

> ç±»ä¼¼çš„é—®é¢˜ï¼š
> 
> - è®¢å•åœ¨ 10 åˆ†é’Ÿåæœªæ”¯ä»˜å°±å¤±æ•ˆï¼Œå¦‚ä½•ç”¨ Redis å®ç°ï¼Ÿ
> - çº¢åŒ… 24 å°æ—¶æœªè¢«æŸ¥æ”¶è‡ªåŠ¨é€€è¿˜ï¼Œå¦‚ä½•ç”¨ Redis å®ç°ï¼Ÿ

åŸºäº Redis å®ç°å»¶æ—¶ä»»åŠ¡çš„åŠŸèƒ½æ— éå°±ä¸‹é¢ä¸¤ç§æ–¹æ¡ˆï¼š

1. Redis è¿‡æœŸäº‹ä»¶ç›‘å¬ã€‚
2. Redisson å†…ç½®çš„å»¶æ—¶é˜Ÿåˆ—ã€‚

Redis è¿‡æœŸäº‹ä»¶ç›‘å¬å­˜åœ¨æ—¶æ•ˆæ€§è¾ƒå·®ã€ä¸¢æ¶ˆæ¯ã€å¤šæœåŠ¡å®ä¾‹ä¸‹æ¶ˆæ¯é‡å¤æ¶ˆè´¹ç­‰é—®é¢˜ï¼Œä¸è¢«æ¨èä½¿ç”¨ã€‚

Redisson å†…ç½®çš„å»¶æ—¶é˜Ÿåˆ—å…·å¤‡ä¸‹é¢è¿™äº›ä¼˜åŠ¿ï¼š

1. **å‡å°‘äº†ä¸¢æ¶ˆæ¯çš„å¯èƒ½**ï¼šDelayedQueue ä¸­çš„æ¶ˆæ¯ä¼šè¢«æŒä¹…åŒ–ï¼Œå³ä½¿ Redis å®•æœºäº†ï¼Œæ ¹æ®æŒä¹…åŒ–æœºåˆ¶ï¼Œä¹Ÿåªå¯èƒ½ä¸¢å¤±ä¸€ç‚¹æ¶ˆæ¯ï¼Œå½±å“ä¸å¤§ã€‚å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰«ææ•°æ®åº“çš„æ–¹æ³•ä½œä¸ºè¡¥å¿æœºåˆ¶ã€‚
2. **æ¶ˆæ¯ä¸å­˜åœ¨é‡å¤æ¶ˆè´¹é—®é¢˜**ï¼šæ¯ä¸ªå®¢æˆ·ç«¯éƒ½æ˜¯ä»åŒä¸€ä¸ªç›®æ ‡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡çš„ï¼Œä¸å­˜åœ¨é‡å¤æ¶ˆè´¹çš„é—®é¢˜ã€‚

å…³äº Redis å®ç°å»¶æ—¶ä»»åŠ¡çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[å¦‚ä½•åŸºäº Redis å®ç°å»¶æ—¶ä»»åŠ¡ï¼Ÿ](/database/redis/redis-delayed-task.html)ã€‚

## [Redis æ•°æ®ç±»å‹](#redis-æ•°æ®ç±»å‹)

å…³äº Redis 5 ç§åŸºç¡€æ•°æ®ç±»å‹å’Œ 3 ç§ç‰¹æ®Šæ•°æ®ç±»å‹çš„è¯¦ç»†ä»‹ç»è¯·çœ‹ä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ä»¥åŠ [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/docs/data-types/)ï¼š

- [Redis 5 ç§åŸºæœ¬æ•°æ®ç±»å‹è¯¦è§£](https://javaguide.cn/database/redis/redis-data-structures-01.html)
- [Redis 3 ç§ç‰¹æ®Šæ•°æ®ç±»å‹è¯¦è§£](https://javaguide.cn/database/redis/redis-data-structures-02.html)

### [Redis å¸¸ç”¨çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ](#redis-å¸¸ç”¨çš„æ•°æ®ç±»å‹æœ‰å“ªäº›)

Redis ä¸­æ¯”è¾ƒå¸¸è§çš„æ•°æ®ç±»å‹æœ‰ä¸‹é¢è¿™äº›ï¼š

- **5 ç§åŸºç¡€æ•°æ®ç±»å‹**ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚
- **3 ç§ç‰¹æ®Šæ•°æ®ç±»å‹**ï¼šHyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ã€Bitmap ï¼ˆä½å›¾ï¼‰ã€Geospatial (åœ°ç†ä½ç½®)ã€‚

é™¤äº†ä¸Šé¢æåˆ°çš„ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ¯”å¦‚ [Bloom filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰](https://javaguide.cn/cs-basics/data-structure/bloom-filter.html)ã€Bitfieldï¼ˆä½åŸŸï¼‰ã€‚

### [String çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ](#string-çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›)

String æ˜¯ Redis ä¸­æœ€ç®€å•åŒæ—¶ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ•°æ®ç±»å‹ã€‚å®ƒæ˜¯ä¸€ç§äºŒè¿›åˆ¶å®‰å…¨çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®æ¯”å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å›¾ç‰‡ï¼ˆå›¾ç‰‡çš„ base64 ç¼–ç æˆ–è€…è§£ç æˆ–è€…å›¾ç‰‡çš„è·¯å¾„ï¼‰ã€åºåˆ—åŒ–åçš„å¯¹è±¡ã€‚

String çš„å¸¸è§åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š

- å¸¸è§„æ•°æ®ï¼ˆæ¯”å¦‚ Sessionã€Tokenã€åºåˆ—åŒ–åçš„å¯¹è±¡ã€å›¾ç‰‡çš„è·¯å¾„ï¼‰çš„ç¼“å­˜ï¼›
- è®¡æ•°æ¯”å¦‚ç”¨æˆ·å•ä½æ—¶é—´çš„è¯·æ±‚æ•°ï¼ˆç®€å•é™æµå¯ä»¥ç”¨åˆ°ï¼‰ã€é¡µé¢å•ä½æ—¶é—´çš„è®¿é—®æ•°ï¼›
- åˆ†å¸ƒå¼é”ï¼ˆåˆ©ç”¨ `SETNX key value` å‘½ä»¤å¯ä»¥å®ç°ä¸€ä¸ªæœ€ç®€æ˜“çš„åˆ†å¸ƒå¼é”ï¼‰ï¼›
- â€¦â€¦

å…³äº String çš„è¯¦ç»†ä»‹ç»è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š[Redis 5 ç§åŸºæœ¬æ•°æ®ç±»å‹è¯¦è§£](https://javaguide.cn/database/redis/redis-data-structures-01.html)ã€‚

### [String è¿˜æ˜¯ Hash å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ](#string-è¿˜æ˜¯-hash-å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢)

ç®€å•å¯¹æ¯”ä¸€ä¸‹äºŒè€…ï¼š

- **å¯¹è±¡å­˜å‚¨æ–¹å¼**ï¼šString å­˜å‚¨çš„æ˜¯åºåˆ—åŒ–åçš„å¯¹è±¡æ•°æ®ï¼Œå­˜æ”¾çš„æ˜¯æ•´ä¸ªå¯¹è±¡ï¼Œæ“ä½œç®€å•ç›´æ¥ã€‚Hash æ˜¯å¯¹å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œå¯ä»¥è·å–éƒ¨åˆ†å­—æ®µçš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æˆ–è€…æ·»åŠ éƒ¨åˆ†å­—æ®µï¼ŒèŠ‚çœç½‘ç»œæµé‡ã€‚å¦‚æœå¯¹è±¡ä¸­æŸäº›å­—æ®µéœ€è¦ç»å¸¸å˜åŠ¨æˆ–è€…ç»å¸¸éœ€è¦å•ç‹¬æŸ¥è¯¢å¯¹è±¡ä¸­çš„ä¸ªåˆ«å­—æ®µä¿¡æ¯ï¼ŒHash å°±éå¸¸é€‚åˆã€‚
- **å†…å­˜æ¶ˆè€—**ï¼šHash é€šå¸¸æ¯” String æ›´èŠ‚çœå†…å­˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å­—æ®µè¾ƒå¤šä¸”å­—æ®µé•¿åº¦è¾ƒçŸ­æ—¶ã€‚Redis å¯¹å°å‹ Hash è¿›è¡Œä¼˜åŒ–ï¼ˆå¦‚ä½¿ç”¨ ziplist å­˜å‚¨ï¼‰ï¼Œè¿›ä¸€æ­¥é™ä½å†…å­˜å ç”¨ã€‚
- **å¤æ‚å¯¹è±¡å­˜å‚¨**ï¼šString åœ¨å¤„ç†å¤šå±‚åµŒå¥—æˆ–å¤æ‚ç»“æ„çš„å¯¹è±¡æ—¶æ›´æ–¹ä¾¿ï¼Œå› ä¸ºæ— éœ€å¤„ç†æ¯ä¸ªå­—æ®µçš„ç‹¬ç«‹å­˜å‚¨å’Œæ“ä½œã€‚
- **æ€§èƒ½**ï¼šString çš„æ“ä½œé€šå¸¸å…·æœ‰ O(1) çš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå®ƒå­˜å‚¨çš„æ˜¯æ•´ä¸ªå¯¹è±¡ï¼Œæ“ä½œç®€å•ç›´æ¥ï¼Œæ•´ä½“è¯»å†™çš„æ€§èƒ½è¾ƒå¥½ã€‚Hash ç”±äºéœ€è¦å¤„ç†å¤šä¸ªå­—æ®µçš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œåœ¨å­—æ®µè¾ƒå¤šä¸”ç»å¸¸å˜åŠ¨çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚

æ€»ç»“ï¼š

- åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ**String** æ›´é€‚åˆå­˜å‚¨å¯¹è±¡æ•°æ®ï¼Œå°¤å…¶æ˜¯å½“å¯¹è±¡ç»“æ„ç®€å•ä¸”æ•´ä½“è¯»å†™æ˜¯ä¸»è¦æ“ä½œæ—¶ã€‚
- å¦‚æœä½ éœ€è¦é¢‘ç¹æ“ä½œå¯¹è±¡çš„éƒ¨åˆ†å­—æ®µæˆ–èŠ‚çœå†…å­˜ï¼Œ**Hash** å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

### [String çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼Ÿ](#string-çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ)

Redis æ˜¯åŸºäº C è¯­è¨€ç¼–å†™çš„ï¼Œä½† Redis çš„ String ç±»å‹çš„åº•å±‚å®ç°å¹¶ä¸æ˜¯ C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼ˆå³ä»¥ç©ºå­—ç¬¦ `\0` ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼‰ï¼Œè€Œæ˜¯è‡ªå·±ç¼–å†™äº† [SDS](https://github.com/antirez/sds)ï¼ˆSimple Dynamic Stringï¼Œç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰æ¥ä½œä¸ºåº•å±‚å®ç°ã€‚

SDS æœ€æ—©æ˜¯ Redis ä½œè€…ä¸ºæ—¥å¸¸ C è¯­è¨€å¼€å‘è€Œè®¾è®¡çš„ C å­—ç¬¦ä¸²ï¼Œåæ¥è¢«åº”ç”¨åˆ°äº† Redis ä¸Šï¼Œå¹¶ç»è¿‡äº†å¤§é‡çš„ä¿®æ”¹å®Œå–„ä»¥é€‚åˆé«˜æ€§èƒ½æ“ä½œã€‚

Redis7.0 çš„ SDS çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼ˆ[https://github.com/redis/redis/blob/7.0/src/sds.h](https://github.com/redis/redis/blob/7.0/src/sds.h)ï¼‰ï¼š

```
/* Note: sdshdr5 is never used, we just access the flags byte directly.
 * However is here to document the layout of type 5 SDS strings. */
struct __attribute__ ((__packed__)) sdshdr5 {
    unsigned char flags; /* 3 lsb of type, and 5 msb of string length */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; /* used */
    uint8_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr16 {
    uint16_t len; /* used */
    uint16_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr32 {
    uint32_t len; /* used */
    uint32_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; /* used */
    uint64_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
```

é€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼ŒSDS å…±æœ‰äº”ç§å®ç°æ–¹å¼ï¼šSDS_TYPE_5ï¼ˆå¹¶æœªç”¨åˆ°ï¼‰ã€SDS_TYPE_8ã€SDS_TYPE_16ã€SDS_TYPE_32ã€SDS_TYPE_64ï¼Œå…¶ä¸­åªæœ‰åå››ç§å®é™…ç”¨åˆ°ã€‚Redis ä¼šæ ¹æ®åˆå§‹åŒ–çš„é•¿åº¦å†³å®šä½¿ç”¨å“ªç§ç±»å‹ï¼Œä»è€Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚

|ç±»å‹|å­—èŠ‚|ä½|
|---|---|---|
|sdshdr5|< 1|<8|
|sdshdr8|1|8|
|sdshdr16|2|16|
|sdshdr32|4|32|
|sdshdr64|8|64|

å¯¹äºåå››ç§å®ç°éƒ½åŒ…å«äº†ä¸‹é¢è¿™ 4 ä¸ªå±æ€§ï¼š

- `len`ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦ä¹Ÿå°±æ˜¯å·²ç»ä½¿ç”¨çš„å­—èŠ‚æ•°ã€‚
- `alloc`ï¼šæ€»å…±å¯ç”¨çš„å­—ç¬¦ç©ºé—´å¤§å°ï¼Œalloc-len å°±æ˜¯ SDS å‰©ä½™çš„ç©ºé—´å¤§å°ã€‚
- `buf[]`ï¼šå®é™…å­˜å‚¨å­—ç¬¦ä¸²çš„æ•°ç»„ã€‚
- `flags`ï¼šä½ä¸‰ä½ä¿å­˜ç±»å‹æ ‡å¿—ã€‚

SDS ç›¸æ¯”äº C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æœ‰å¦‚ä¸‹æå‡ï¼š

1. **å¯ä»¥é¿å…ç¼“å†²åŒºæº¢å‡º**ï¼šC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²è¢«ä¿®æ”¹ï¼ˆæ¯”å¦‚æ‹¼æ¥ï¼‰æ—¶ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚SDS è¢«ä¿®æ”¹æ—¶ï¼Œä¼šå…ˆæ ¹æ® len å±æ€§æ£€æŸ¥ç©ºé—´å¤§å°æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™å…ˆæ‰©å±•è‡³æ‰€éœ€å¤§å°å†è¿›è¡Œä¿®æ”¹æ“ä½œã€‚
2. **è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦è¾ƒä½**ï¼šC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯ç»è¿‡éå†è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚SDS çš„é•¿åº¦è·å–ç›´æ¥è¯»å– len å±æ€§å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚
3. **å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°**ï¼šä¸ºäº†é¿å…ä¿®æ”¹ï¼ˆå¢åŠ /å‡å°‘ï¼‰å­—ç¬¦ä¸²æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆC è¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯è¿™æ ·çš„ï¼‰ï¼ŒSDS å®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚å½“ SDS éœ€è¦å¢åŠ å­—ç¬¦ä¸²æ—¶ï¼ŒRedis ä¼šä¸º SDS åˆ†é…å¥½å†…å­˜ï¼Œå¹¶ä¸”æ ¹æ®ç‰¹å®šçš„ç®—æ³•åˆ†é…å¤šä½™çš„å†…å­˜ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚å½“ SDS éœ€è¦å‡å°‘å­—ç¬¦ä¸²æ—¶ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ï¼ˆæ”¯æŒæ‰‹åŠ¨é‡Šæ”¾ï¼Œæœ‰å¯¹åº”çš„ APIï¼‰ã€‚
4. **äºŒè¿›åˆ¶å®‰å…¨**ï¼šC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ `\0` ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè¿™å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œåƒä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰å°±å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ï¼ŒC å­—ç¬¦ä¸²æ— æ³•æ­£ç¡®ä¿å­˜ã€‚SDS ä½¿ç”¨ len å±æ€§åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸï¼Œä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚

ğŸ¤ å¤šæä¸€å˜´ï¼Œå¾ˆå¤šæ–‡ç« é‡Œ SDS çš„å®šä¹‰æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š

```
struct sdshdr {
    unsigned int len;
    unsigned int free;
    char buf[];
};
```

è¿™ä¸ªä¹Ÿæ²¡é”™ï¼ŒRedis 3.2 ä¹‹å‰å°±æ˜¯è¿™æ ·å®šä¹‰çš„ã€‚åæ¥ï¼Œç”±äºè¿™ç§æ–¹å¼çš„å®šä¹‰å­˜åœ¨é—®é¢˜ï¼Œ`len` å’Œ `free` çš„å®šä¹‰ç”¨äº† 4 ä¸ªå­—èŠ‚ï¼Œé€ æˆäº†æµªè´¹ã€‚Redis 3.2 ä¹‹åï¼ŒRedis æ”¹è¿›äº† SDS çš„å®šä¹‰ï¼Œå°†å…¶åˆ’åˆ†ä¸ºäº†ç°åœ¨çš„ 5 ç§ç±»å‹ã€‚

### [è´­ç‰©è½¦ä¿¡æ¯ç”¨ String è¿˜æ˜¯ Hash å­˜å‚¨æ›´å¥½å‘¢?](#è´­ç‰©è½¦ä¿¡æ¯ç”¨-string-è¿˜æ˜¯-hash-å­˜å‚¨æ›´å¥½å‘¢)

ç”±äºè´­ç‰©è½¦ä¸­çš„å•†å“é¢‘ç¹ä¿®æ”¹å’Œå˜åŠ¨ï¼Œè´­ç‰©è½¦ä¿¡æ¯å»ºè®®ä½¿ç”¨ Hash å­˜å‚¨ï¼š

- ç”¨æˆ· id ä¸º key
- å•†å“ id ä¸º fieldï¼Œå•†å“æ•°é‡ä¸º value

![Hashç»´æŠ¤ç®€å•çš„è´­ç‰©è½¦ä¿¡æ¯](https://oss.javaguide.cn/github/javaguide/database/redis/hash-shopping-cart.png)

é‚£ç”¨æˆ·è´­ç‰©è½¦ä¿¡æ¯çš„ç»´æŠ¤å…·ä½“åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ

- ç”¨æˆ·æ·»åŠ å•†å“å°±æ˜¯å¾€ Hash é‡Œé¢å¢åŠ æ–°çš„ field ä¸ valueï¼›
- æŸ¥è¯¢è´­ç‰©è½¦ä¿¡æ¯å°±æ˜¯éå†å¯¹åº”çš„ Hashï¼›
- æ›´æ”¹å•†å“æ•°é‡ç›´æ¥ä¿®æ”¹å¯¹åº”çš„ value å€¼ï¼ˆç›´æ¥ set æˆ–è€…åšè¿ç®—çš†å¯ï¼‰ï¼›
- åˆ é™¤å•†å“å°±æ˜¯åˆ é™¤ Hash ä¸­å¯¹åº”çš„ fieldï¼›
- æ¸…ç©ºè´­ç‰©è½¦ç›´æ¥åˆ é™¤å¯¹åº”çš„ key å³å¯ã€‚

è¿™é‡Œåªæ˜¯ä»¥ä¸šåŠ¡æ¯”è¾ƒç®€å•çš„è´­ç‰©è½¦åœºæ™¯ä¸¾ä¾‹ï¼Œå®é™…ç”µå•†åœºæ™¯ä¸‹ï¼Œfield åªä¿å­˜ä¸€ä¸ªå•†å“ id æ˜¯æ²¡åŠæ³•æ»¡è¶³éœ€æ±‚çš„ã€‚

### [ä½¿ç”¨ Redis å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-redis-å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåš)

Redis ä¸­æœ‰ä¸€ä¸ªå«åš `Sorted Set`ï¼ˆæœ‰åºé›†åˆï¼‰çš„æ•°æ®ç±»å‹ç»å¸¸è¢«ç”¨åœ¨å„ç§æ’è¡Œæ¦œçš„åœºæ™¯ï¼Œæ¯”å¦‚ç›´æ’­é—´é€ç¤¼ç‰©çš„æ’è¡Œæ¦œã€æœ‹å‹åœˆçš„å¾®ä¿¡æ­¥æ•°æ’è¡Œæ¦œã€ç‹è€…è£è€€ä¸­çš„æ®µä½æ’è¡Œæ¦œã€è¯é¢˜çƒ­åº¦æ’è¡Œæ¦œç­‰ç­‰ã€‚

ç›¸å…³çš„ä¸€äº› Redis å‘½ä»¤ï¼š`ZRANGE`ï¼ˆä»å°åˆ°å¤§æ’åºï¼‰ã€`ZREVRANGE`ï¼ˆä»å¤§åˆ°å°æ’åºï¼‰ã€`ZREVRANK`ï¼ˆæŒ‡å®šå…ƒç´ æ’åï¼‰ã€‚

![](https://oss.javaguide.cn/github/javaguide/database/redis/2021060714195385.png)

[ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹](https://javaguide.cn/zhuanlan/java-mian-shi-zhi-bei.html) çš„ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€å°±æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Sorted Set æ¥è®¾è®¡åˆ¶ä½œä¸€ä¸ªæ’è¡Œæ¦œï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚

![](https://oss.javaguide.cn/github/javaguide/database/redis/image-20220719071115140.png)

### [Redis çš„æœ‰åºé›†åˆåº•å±‚ä¸ºä»€ä¹ˆè¦ç”¨è·³è¡¨ï¼Œè€Œä¸ç”¨å¹³è¡¡æ ‘ã€çº¢é»‘æ ‘æˆ–è€… B+ æ ‘ï¼Ÿ](#redis-çš„æœ‰åºé›†åˆåº•å±‚ä¸ºä»€ä¹ˆè¦ç”¨è·³è¡¨-è€Œä¸ç”¨å¹³è¡¡æ ‘ã€çº¢é»‘æ ‘æˆ–è€…-b-æ ‘)

è¿™é“é¢è¯•é¢˜å¾ˆå¤šå¤§å‚æ¯”è¾ƒå–œæ¬¢é—®ï¼Œéš¾åº¦è¿˜æ˜¯æœ‰ç‚¹å¤§çš„ã€‚

- å¹³è¡¡æ ‘ vs è·³è¡¨ï¼šå¹³è¡¡æ ‘çš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å’Œè·³è¡¨ä¸€æ ·éƒ½æ˜¯ **O(log n)**ã€‚å¯¹äºèŒƒå›´æŸ¥è¯¢æ¥è¯´ï¼Œå¹³è¡¡æ ‘ä¹Ÿå¯ä»¥é€šè¿‡ä¸­åºéå†çš„æ–¹å¼è¾¾åˆ°å’Œè·³è¡¨ä¸€æ ·çš„æ•ˆæœã€‚ä½†æ˜¯å®ƒçš„æ¯ä¸€æ¬¡æ’å…¥æˆ–è€…åˆ é™¤æ“ä½œéƒ½éœ€è¦ä¿è¯æ•´é¢—æ ‘å·¦å³èŠ‚ç‚¹çš„ç»å¯¹å¹³è¡¡ï¼Œåªè¦ä¸å¹³è¡¡å°±è¦é€šè¿‡æ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚è·³è¡¨è¯ç”Ÿçš„åˆè¡·å°±æ˜¯ä¸ºäº†å…‹æœå¹³è¡¡æ ‘çš„ä¸€äº›ç¼ºç‚¹ã€‚è·³è¡¨ä½¿ç”¨æ¦‚ç‡å¹³è¡¡è€Œä¸æ˜¯ä¸¥æ ¼å¼ºåˆ¶çš„å¹³è¡¡ï¼Œå› æ­¤ï¼Œè·³è¡¨ä¸­çš„æ’å…¥å’Œåˆ é™¤ç®—æ³•æ¯”å¹³è¡¡æ ‘çš„ç­‰æ•ˆç®—æ³•ç®€å•å¾—å¤šï¼Œé€Ÿåº¦ä¹Ÿå¿«å¾—å¤šã€‚
- çº¢é»‘æ ‘ vs è·³è¡¨ï¼šç›¸æ¯”è¾ƒäºçº¢é»‘æ ‘æ¥è¯´ï¼Œè·³è¡¨çš„å®ç°ä¹Ÿæ›´ç®€å•ä¸€äº›ï¼Œä¸éœ€è¦é€šè¿‡æ—‹è½¬å’ŒæŸ“è‰²ï¼ˆçº¢é»‘å˜æ¢ï¼‰æ¥ä¿è¯é»‘å¹³è¡¡ã€‚å¹¶ä¸”ï¼ŒæŒ‰ç…§åŒºé—´æ¥æŸ¥æ‰¾æ•°æ®è¿™ä¸ªæ“ä½œï¼Œçº¢é»‘æ ‘çš„æ•ˆç‡æ²¡æœ‰è·³è¡¨é«˜ã€‚
- B+ æ ‘ vs è·³è¡¨ï¼šB+ æ ‘æ›´é€‚åˆä½œä¸ºæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿä¸­å¸¸ç”¨çš„ç´¢å¼•ç»“æ„ä¹‹ä¸€ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¯èƒ½å°‘çš„ IO å®šä½åˆ°å°½å¯èƒ½å¤šçš„ç´¢å¼•æ¥è·å¾—æŸ¥è¯¢æ•°æ®ã€‚å¯¹äº Redis è¿™ç§å†…å­˜æ•°æ®åº“æ¥è¯´ï¼Œå®ƒå¯¹è¿™äº›å¹¶ä¸æ„Ÿå†’ï¼Œå› ä¸º Redis ä½œä¸ºå†…å­˜æ•°æ®åº“å®ƒä¸å¯èƒ½å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥å¯¹äºç´¢å¼•ä¸éœ€è¦é€šè¿‡ B+ æ ‘è¿™ç§æ–¹å¼è¿›è¡Œç»´æŠ¤ï¼Œåªéœ€æŒ‰ç…§æ¦‚ç‡è¿›è¡Œéšæœºç»´æŠ¤å³å¯ï¼ŒèŠ‚çº¦å†…å­˜ã€‚è€Œä¸”ä½¿ç”¨è·³è¡¨å®ç° zset æ—¶ç›¸è¾ƒå‰è€…æ¥è¯´æ›´ç®€å•ä¸€äº›ï¼Œåœ¨è¿›è¡Œæ’å…¥æ—¶åªéœ€é€šè¿‡ç´¢å¼•å°†æ•°æ®æ’å…¥åˆ°é“¾è¡¨ä¸­åˆé€‚çš„ä½ç½®å†éšæœºç»´æŠ¤ä¸€å®šé«˜åº¦çš„ç´¢å¼•å³å¯ï¼Œä¹Ÿä¸éœ€è¦åƒ B+ æ ‘é‚£æ ·æ’å…¥æ—¶å‘ç°å¤±è¡¡æ—¶è¿˜éœ€è¦å¯¹èŠ‚ç‚¹åˆ†è£‚ä¸åˆå¹¶ã€‚

å¦å¤–ï¼Œæˆ‘è¿˜å•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« ä»æœ‰åºé›†åˆçš„åŸºæœ¬ä½¿ç”¨åˆ°è·³è¡¨çš„æºç åˆ†æå’Œå®ç°ï¼Œè®©ä½ ä¼šå¯¹ Redis çš„æœ‰åºé›†åˆåº•å±‚å®ç°çš„è·³è¡¨æœ‰ç€æ›´æ·±åˆ»çš„ç†è§£å’ŒæŒæ¡ï¼š[Redis ä¸ºä»€ä¹ˆç”¨è·³è¡¨å®ç°æœ‰åºé›†åˆ](/database/redis/redis-skiplist.html)ã€‚

### [Set çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ](#set-çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆ)

Redis ä¸­ `Set` æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºä½†éƒ½å”¯ä¸€ï¼Œæœ‰ç‚¹ç±»ä¼¼äº Java ä¸­çš„ `HashSet` ã€‚

`Set` çš„å¸¸è§åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š

- å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤çš„åœºæ™¯ï¼šç½‘ç«™ UV ç»Ÿè®¡ï¼ˆæ•°æ®é‡å·¨å¤§çš„åœºæ™¯è¿˜æ˜¯ `HyperLogLog` æ›´é€‚åˆä¸€äº›ï¼‰ã€æ–‡ç« ç‚¹èµã€åŠ¨æ€ç‚¹èµç­‰ç­‰ã€‚
- éœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†ã€å¹¶é›†å’Œå·®é›†çš„åœºæ™¯ï¼šå…±åŒå¥½å‹ï¼ˆäº¤é›†ï¼‰ã€å…±åŒç²‰ä¸ï¼ˆäº¤é›†ï¼‰ã€å…±åŒå…³æ³¨ï¼ˆäº¤é›†ï¼‰ã€å¥½å‹æ¨èï¼ˆå·®é›†ï¼‰ã€éŸ³ä¹æ¨èï¼ˆå·®é›†ï¼‰ã€è®¢é˜…å·æ¨èï¼ˆå·®é›†+äº¤é›†ï¼‰ç­‰ç­‰ã€‚
- éœ€è¦éšæœºè·å–æ•°æ®æºä¸­çš„å…ƒç´ çš„åœºæ™¯ï¼šæŠ½å¥–ç³»ç»Ÿã€éšæœºç‚¹åç­‰ç­‰ã€‚

### [ä½¿ç”¨ Set å®ç°æŠ½å¥–ç³»ç»Ÿæ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-set-å®ç°æŠ½å¥–ç³»ç»Ÿæ€ä¹ˆåš)

å¦‚æœæƒ³è¦ä½¿ç”¨ `Set` å®ç°ä¸€ä¸ªç®€å•çš„æŠ½å¥–ç³»ç»Ÿçš„è¯ï¼Œç›´æ¥ä½¿ç”¨ä¸‹é¢è¿™å‡ ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ï¼š

- `SADD key member1 member2 ...`ï¼šå‘æŒ‡å®šé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚
- `SPOP key count`ï¼šéšæœºç§»é™¤å¹¶è·å–æŒ‡å®šé›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œé€‚åˆä¸å…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ã€‚
- `SRANDMEMBER key count`ï¼šéšæœºè·å–æŒ‡å®šé›†åˆä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œé€‚åˆå…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ã€‚

### [ä½¿ç”¨ Bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·æ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-bitmap-ç»Ÿè®¡æ´»è·ƒç”¨æˆ·æ€ä¹ˆåš)

Bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ Bitmapï¼Œåªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº«ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ Bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚

ä½ å¯ä»¥å°† Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ªå­˜å‚¨äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ä¸‹æ ‡å«åš offsetï¼ˆåç§»é‡ï¼‰ã€‚

![img](https://oss.javaguide.cn/github/javaguide/database/redis/image-20220720194154133.png)

å¦‚æœæƒ³è¦ä½¿ç”¨ Bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨æ—¥æœŸï¼ˆç²¾ç¡®åˆ°å¤©ï¼‰ä½œä¸º keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœå½“æ—¥æ´»è·ƒè¿‡å°±è®¾ç½®ä¸º 1ã€‚

åˆå§‹åŒ–æ•°æ®ï¼š

```
> SETBIT 20210308 1 1
(integer) 0
> SETBIT 20210308 2 1
(integer) 0
> SETBIT 20210309 1 1
(integer) 0
```

ç»Ÿè®¡ 20210308~20210309 æ€»æ´»è·ƒç”¨æˆ·æ•°ï¼š

```
> BITOP and desk1 20210308 20210309
(integer) 1
> BITCOUNT desk1
(integer) 1
```

ç»Ÿè®¡ 20210308~20210309 åœ¨çº¿æ´»è·ƒç”¨æˆ·æ•°ï¼š

```
> BITOP or desk2 20210308 20210309
(integer) 1
> BITCOUNT desk2
(integer) 2
```

### [ä½¿ç”¨ HyperLogLog ç»Ÿè®¡é¡µé¢ UV æ€ä¹ˆåšï¼Ÿ](#ä½¿ç”¨-hyperloglog-ç»Ÿè®¡é¡µé¢-uv-æ€ä¹ˆåš)

ä½¿ç”¨ HyperLogLog ç»Ÿè®¡é¡µé¢ UV ä¸»è¦éœ€è¦ç”¨åˆ°ä¸‹é¢è¿™ä¸¤ä¸ªå‘½ä»¤ï¼š

- `PFADD key element1 element2 ...`ï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ° HyperLogLog ä¸­ã€‚
- `PFCOUNT key1 key2`ï¼šè·å–ä¸€ä¸ªæˆ–è€…å¤šä¸ª HyperLogLog çš„å”¯ä¸€è®¡æ•°ã€‚

1ã€å°†è®¿é—®æŒ‡å®šé¡µé¢çš„æ¯ä¸ªç”¨æˆ· ID æ·»åŠ åˆ° `HyperLogLog` ä¸­ã€‚

```
PFADD PAGE_1:UV USER1 USER2 ...... USERn
```

2ã€ç»Ÿè®¡æŒ‡å®šé¡µé¢çš„ UVã€‚

```
PFCOUNT PAGE_1:UV
```

## [Redis æŒä¹…åŒ–æœºåˆ¶ï¼ˆé‡è¦ï¼‰](#redis-æŒä¹…åŒ–æœºåˆ¶-é‡è¦)

Redis æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDB æŒä¹…åŒ–ã€AOF æŒä¹…åŒ–ã€RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–ï¼‰ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œäºæ˜¯æˆ‘å•ç‹¬æŠ½äº†ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ Redis æŒä¹…åŒ–æœºåˆ¶ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œé—®é¢˜ï¼š[Redis æŒä¹…åŒ–æœºåˆ¶è¯¦è§£](https://javaguide.cn/database/redis/redis-persistence.html)ã€‚

## [Redis çº¿ç¨‹æ¨¡å‹ï¼ˆé‡è¦ï¼‰](#redis-çº¿ç¨‹æ¨¡å‹-é‡è¦)

å¯¹äºè¯»å†™å‘½ä»¤æ¥è¯´ï¼ŒRedis ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚ä¸è¿‡ï¼Œåœ¨ Redis 4.0 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›å¤§é”®å€¼å¯¹çš„å¼‚æ­¥åˆ é™¤æ“ä½œï¼ŒRedis 6.0 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼ˆæé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½ï¼‰ã€‚

### [Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ](#redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—)

**Redis åŸºäº Reactor æ¨¡å¼è®¾è®¡å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹**ï¼ˆNetty çš„çº¿ç¨‹æ¨¡å‹ä¹ŸåŸºäº Reactor æ¨¡å¼ï¼ŒReactor æ¨¡å¼ä¸æ„§æ˜¯é«˜æ€§èƒ½ IO çš„åŸºçŸ³ï¼‰ï¼Œè¿™å¥—äº‹ä»¶å¤„ç†æ¨¡å‹å¯¹åº”çš„æ˜¯ Redis ä¸­çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚ç”±äºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰æ˜¯å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚

ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹æœ‰ä¸€æ®µè¯æ˜¯è¿™æ ·ä»‹ç»æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ï¼Œæˆ‘è§‰å¾—å†™å¾—æŒºä¸é”™ã€‚

> Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚
> 
> - æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚
> - å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚
> 
> **è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—**ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚

**æ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œé‚£æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ**

Redis é€šè¿‡ **IO å¤šè·¯å¤ç”¨ç¨‹åº** æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼ˆæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socketï¼‰ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹ï¼ˆè¯»ã€å†™ï¼‰æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚

è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š**I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—**ï¼ˆå’Œ NIO ä¸­çš„ `Selector` ç»„ä»¶å¾ˆåƒï¼‰ã€‚

æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š

- å¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰
- IO å¤šè·¯å¤ç”¨ç¨‹åºï¼ˆæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰
- æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰
- äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰

![æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰](https://oss.javaguide.cn/github/javaguide/database/redis/redis-event-handler.png)

ç›¸å…³é˜…è¯»ï¼š[Redis äº‹ä»¶æœºåˆ¶è¯¦è§£](http://remcarpediem.net/article/1aa2da89/)ã€‚

### [Redis6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ](#redis6-0-ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹)

è™½ç„¶è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†å®é™…ä¸Šï¼Œ**Redis åœ¨ 4.0 ä¹‹åçš„ç‰ˆæœ¬ä¸­å°±å·²ç»åŠ å…¥äº†å¯¹å¤šçº¿ç¨‹çš„æ”¯æŒã€‚**

ä¸è¿‡ï¼ŒRedis 4.0 å¢åŠ çš„å¤šçº¿ç¨‹ä¸»è¦æ˜¯é’ˆå¯¹ä¸€äº›å¤§é”®å€¼å¯¹çš„åˆ é™¤æ“ä½œçš„å‘½ä»¤ï¼Œä½¿ç”¨è¿™äº›å‘½ä»¤å°±ä¼šä½¿ç”¨ä¸»çº¿ç¨‹ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹æ¥â€œå¼‚æ­¥å¤„ç†â€ï¼Œä»è€Œå‡å°‘å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚

ä¸ºæ­¤ï¼ŒRedis 4.0 ä¹‹åæ–°å¢äº†å‡ ä¸ªå¼‚æ­¥å‘½ä»¤ï¼š

- `UNLINK`ï¼šå¯ä»¥çœ‹ä½œæ˜¯ `DEL` å‘½ä»¤çš„å¼‚æ­¥ç‰ˆæœ¬ã€‚
- `FLUSHALL ASYNC`ï¼šç”¨äºæ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰é”®ï¼Œä¸é™äºå½“å‰ `SELECT` çš„æ•°æ®åº“ã€‚
- `FLUSHDB ASYNC`ï¼šç”¨äºæ¸…ç©ºå½“å‰ `SELECT` æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®ã€‚

![redis4.0 more thread](https://oss.javaguide.cn/github/javaguide/database/redis/redis4.0-more-thread.png)

æ€»çš„æ¥è¯´ï¼Œç›´åˆ° Redis 6.0 ä¹‹å‰ï¼ŒRedis çš„ä¸»è¦æ“ä½œä»ç„¶æ˜¯å•çº¿ç¨‹å¤„ç†çš„ã€‚

**é‚£ Redis6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ** æˆ‘è§‰å¾—ä¸»è¦åŸå› æœ‰ 3 ç‚¹ï¼š

- å•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼›
- Redis çš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPUï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼›
- å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚

ç›¸å…³é˜…è¯»ï¼š[ä¸ºä»€ä¹ˆ Redis é€‰æ‹©å•çº¿ç¨‹æ¨¡å‹ï¼Ÿ](https://draveness.me/whys-the-design-redis-single-thread/)ã€‚

### [Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ](#redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹)

**Redis6.0 å¼•å…¥å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½**ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯ Redis ä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆï¼ˆRedis çš„ç“¶é¢ˆä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œï¼‰ã€‚

è™½ç„¶ï¼ŒRedis6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯ Redis çš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨äº†ï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

Redis6.0 çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦è®¾ç½® IO çº¿ç¨‹æ•° > 1ï¼Œéœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ `redis.conf`ï¼š

```
io-threads 4 #è®¾ç½®1çš„è¯åªä¼šå¼€å¯ä¸»çº¿ç¨‹ï¼Œå®˜ç½‘å»ºè®®4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹
```

å¦å¤–ï¼š

- io-threads çš„ä¸ªæ•°ä¸€æ—¦è®¾ç½®ï¼Œä¸èƒ½é€šè¿‡ config åŠ¨æ€è®¾ç½®ã€‚
- å½“è®¾ç½® ssl åï¼Œio-threads å°†ä¸å·¥ä½œã€‚

å¼€å¯å¤šçº¿ç¨‹åï¼Œé»˜è®¤åªä¼šä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œ IO å†™å…¥ writesï¼Œå³å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœéœ€è¦å¼€å¯å¤šçº¿ç¨‹ IO è¯»å– readsï¼ŒåŒæ ·éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ `redis.conf`ï¼š

```
io-threads-do-reads yes
```

ä½†æ˜¯å®˜ç½‘æè¿°å¼€å¯å¤šçº¿ç¨‹è¯»å¹¶ä¸èƒ½æœ‰å¤ªå¤§æå‡ï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸å»ºè®®å¼€å¯ã€‚

ç›¸å…³é˜…è¯»ï¼š

- [Redis 6.0 æ–°ç‰¹æ€§-å¤šçº¿ç¨‹è¿ç¯ 13 é—®ï¼](https://mp.weixin.qq.com/s/FZu3acwK6zrCBZQ_3HoUgw)
- [Redis å¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å…¨é¢æ­ç§˜](https://segmentfault.com/a/1190000039223696)ï¼ˆæ¨èï¼‰

### [Redis åå°çº¿ç¨‹äº†è§£å—ï¼Ÿ](#redis-åå°çº¿ç¨‹äº†è§£å—)

æˆ‘ä»¬è™½ç„¶ç»å¸¸è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼ˆä¸»è¦é€»è¾‘æ˜¯å•çº¿ç¨‹å®Œæˆçš„ï¼‰ï¼Œä½†å®é™…è¿˜æœ‰ä¸€äº›åå°çº¿ç¨‹ç”¨äºæ‰§è¡Œä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼š

- é€šè¿‡ `bio_close_file` åå°çº¿ç¨‹æ¥é‡Šæ”¾ AOF / RDB ç­‰è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶èµ„æºã€‚
- é€šè¿‡ `bio_aof_fsync` åå°çº¿ç¨‹è°ƒç”¨ `fsync` å‡½æ•°å°†ç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºè¿˜æœªåŒæ­¥åˆ°åˆ°ç£ç›˜çš„æ•°æ®å¼ºåˆ¶åˆ·åˆ°ç£ç›˜ï¼ˆAOF æ–‡ä»¶ï¼‰ã€‚
- é€šè¿‡ `bio_lazy_free` åå°çº¿ç¨‹é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå·²åˆ é™¤ï¼‰å ç”¨çš„å†…å­˜ç©ºé—´.

åœ¨`bio.h` æ–‡ä»¶ä¸­æœ‰å®šä¹‰ï¼ˆRedis 6.0 ç‰ˆæœ¬ï¼Œæºç åœ°å€ï¼š[https://github.com/redis/redis/blob/6.0/src/bio.h](https://github.com/redis/redis/blob/6.0/src/bio.h)ï¼‰ï¼š

```
#ifndef __BIO_H
#define __BIO_H

/* Exported API */
void bioInit(void);
void bioCreateBackgroundJob(int type, void *arg1, void *arg2, void *arg3);
unsigned long long bioPendingJobsOfType(int type);
unsigned long long bioWaitStepOfType(int type);
time_t bioOlderJobOfType(int type);
void bioKillThreads(void);

/* Background job opcodes */
#define BIO_CLOSE_FILE    0 /* Deferred close(2) syscall. */
#define BIO_AOF_FSYNC     1 /* Deferred AOF fsync. */
#define BIO_LAZY_FREE     2 /* Deferred objects freeing. */
#define BIO_NUM_OPS       3

#endif
```

å…³äº Redis åå°çº¿ç¨‹çš„è¯¦ç»†ä»‹ç»å¯ä»¥æŸ¥çœ‹ [Redis 6.0 åå°çº¿ç¨‹æœ‰å“ªäº›ï¼Ÿ](https://juejin.cn/post/7102780434739626014) è¿™ç¯‡å°±æ–‡ç« ã€‚

## [Redis å†…å­˜ç®¡ç†](#redis-å†…å­˜ç®¡ç†)

### [Redis ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰ä»€ä¹ˆç”¨ï¼Ÿ](#redis-ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰ä»€ä¹ˆç”¨)

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¿å­˜çš„ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å†…å­˜æ˜¯æœ‰é™ä¸”çè´µçš„ï¼Œå¦‚æœä¸å¯¹ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé‚£å†…å­˜å ç”¨å°±ä¼šä¸€ç›´å¢é•¿ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ OOM é—®é¢˜ã€‚é€šè¿‡è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼ŒRedis ä¼šè‡ªåŠ¨åˆ é™¤æš‚æ—¶ä¸éœ€è¦çš„æ•°æ®ï¼Œä¸ºæ–°çš„ç¼“å­˜æ•°æ®è…¾å‡ºç©ºé—´ã€‚

Redis è‡ªå¸¦äº†ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š

```
127.0.0.1:6379> expire key 60 # æ•°æ®åœ¨ 60s åè¿‡æœŸ
(integer) 1
127.0.0.1:6379> setex key 60 value # æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:[set] + [ex]pire)
OK
127.0.0.1:6379> ttl key # æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ
(integer) 56
```

æ³¨æ„ âš ï¸ï¼šRedis ä¸­é™¤äº†å­—ç¬¦ä¸²ç±»å‹æœ‰è‡ªå·±ç‹¬æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ `setex` å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½éœ€è¦ä¾é  `expire` å‘½ä»¤æ¥è®¾ç½®è¿‡æœŸæ—¶é—´ ã€‚å¦å¤–ï¼Œ`persist` å‘½ä»¤å¯ä»¥ç§»é™¤ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚

**è¿‡æœŸæ—¶é—´é™¤äº†æœ‰åŠ©äºç¼“è§£å†…å­˜çš„æ¶ˆè€—ï¼Œè¿˜æœ‰ä»€ä¹ˆå…¶ä»–ç”¨ä¹ˆï¼Ÿ**

å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯å°±æ˜¯éœ€è¦æŸä¸ªæ•°æ®åªåœ¨æŸä¸€æ—¶é—´æ®µå†…å­˜åœ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„çŸ­ä¿¡éªŒè¯ç å¯èƒ½åªåœ¨ 1 åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œç”¨æˆ·ç™»å½•çš„ Token å¯èƒ½åªåœ¨ 1 å¤©å†…æœ‰æ•ˆã€‚

å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“æ¥å¤„ç†çš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªå·±åˆ¤æ–­è¿‡æœŸï¼Œè¿™æ ·æ›´éº»çƒ¦å¹¶ä¸”æ€§èƒ½è¦å·®å¾ˆå¤šã€‚

### [Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ](#redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢)

Redis é€šè¿‡ä¸€ä¸ªå«åšè¿‡æœŸå­—å…¸ï¼ˆå¯ä»¥çœ‹ä½œæ˜¯ hash è¡¨ï¼‰æ¥ä¿å­˜æ•°æ®è¿‡æœŸçš„æ—¶é—´ã€‚è¿‡æœŸå­—å…¸çš„é”®æŒ‡å‘ Redis æ•°æ®åº“ä¸­çš„æŸä¸ª keyï¼ˆé”®ï¼‰ï¼Œè¿‡æœŸå­—å…¸çš„å€¼æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key æ‰€æŒ‡å‘çš„æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ç²¾åº¦çš„ UNIX æ—¶é—´æˆ³ï¼‰ã€‚

![Redis è¿‡æœŸå­—å…¸](https://oss.javaguide.cn/github/javaguide/database/redis/redis-expired-dictionary.png)

è¿‡æœŸå­—å…¸æ˜¯å­˜å‚¨åœ¨ redisDb è¿™ä¸ªç»“æ„é‡Œçš„ï¼š

```
typedef struct redisDb {
    ...

    dict *dict;     //æ•°æ®åº“é”®ç©ºé—´,ä¿å­˜ç€æ•°æ®åº“ä¸­æ‰€æœ‰é”®å€¼å¯¹
    dict *expires   // è¿‡æœŸå­—å…¸,ä¿å­˜ç€é”®çš„è¿‡æœŸæ—¶é—´
    ...
} redisDb;
```

åœ¨æŸ¥è¯¢ä¸€ä¸ª key çš„æ—¶å€™ï¼ŒRedis é¦–å…ˆæ£€æŸ¥è¯¥ key æ˜¯å¦å­˜åœ¨äºè¿‡æœŸå­—å…¸ä¸­ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼‰ï¼Œå¦‚æœä¸åœ¨å°±ç›´æ¥è¿”å›ï¼Œåœ¨çš„è¯éœ€è¦åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ª key æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸç›´æ¥åˆ é™¤ key ç„¶åè¿”å› nullã€‚

### [Redis è¿‡æœŸ key åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ](#redis-è¿‡æœŸ-key-åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ)

å¦‚æœå‡è®¾ä½ è®¾ç½®äº†ä¸€æ‰¹ key åªèƒ½å­˜æ´» 1 åˆ†é’Ÿï¼Œé‚£ä¹ˆ 1 åˆ†é’Ÿåï¼ŒRedis æ˜¯æ€ä¹ˆå¯¹è¿™æ‰¹ key è¿›è¡Œåˆ é™¤çš„å‘¢ï¼Ÿ

å¸¸ç”¨çš„è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥å°±ä¸‹é¢è¿™å‡ ç§ï¼š

1. **æƒ°æ€§åˆ é™¤**ï¼šåªä¼šåœ¨å–å‡º/æŸ¥è¯¢ key çš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚è¿™ç§æ–¹å¼å¯¹ CPU æœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆå¤ªå¤šè¿‡æœŸ key æ²¡æœ‰è¢«åˆ é™¤ã€‚
2. **å®šæœŸåˆ é™¤**ï¼šå‘¨æœŸæ€§åœ°éšæœºä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­æŠ½æŸ¥ä¸€æ‰¹ï¼Œç„¶åé€ä¸ªæ£€æŸ¥è¿™äº› key æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ é™¤ keyã€‚ç›¸æ¯”äºæƒ°æ€§åˆ é™¤ï¼Œå®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´å‹å¥½ï¼Œå¯¹ CPU ä¸å¤ªå‹å¥½ã€‚
3. **å»¶è¿Ÿé˜Ÿåˆ—**ï¼šæŠŠè®¾ç½®è¿‡æœŸæ—¶é—´çš„ key æ”¾åˆ°ä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—é‡Œï¼Œåˆ°æœŸä¹‹åå°±åˆ é™¤ keyã€‚è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ¯ä¸ªè¿‡æœŸ key éƒ½èƒ½è¢«åˆ é™¤ï¼Œä½†ç»´æŠ¤å»¶è¿Ÿé˜Ÿåˆ—å¤ªéº»çƒ¦ï¼Œé˜Ÿåˆ—æœ¬èº«ä¹Ÿè¦å ç”¨èµ„æºã€‚
4. **å®šæ—¶åˆ é™¤**ï¼šæ¯ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key éƒ½ä¼šåœ¨è®¾ç½®çš„æ—¶é—´åˆ°è¾¾æ—¶ç«‹å³è¢«åˆ é™¤ã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç¡®ä¿å†…å­˜ä¸­ä¸ä¼šæœ‰è¿‡æœŸçš„é”®ï¼Œä½†æ˜¯å®ƒå¯¹ CPU çš„å‹åŠ›æœ€å¤§ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯ä¸ªé”®éƒ½è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ã€‚

**Redis é‡‡ç”¨çš„æ˜¯é‚£ç§åˆ é™¤ç­–ç•¥å‘¢ï¼Ÿ**

Redis é‡‡ç”¨çš„æ˜¯ **å®šæœŸåˆ é™¤+æƒ°æ€§/æ‡’æ±‰å¼åˆ é™¤** ç»“åˆçš„ç­–ç•¥ï¼Œè¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ†ç¼“å­˜æ¡†æ¶çš„é€‰æ‹©ã€‚å®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´åŠ å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹ CPU æ›´åŠ å‹å¥½ã€‚ä¸¤è€…å„æœ‰åƒç§‹ï¼Œç»“åˆèµ·æ¥ä½¿ç”¨æ—¢èƒ½å…¼é¡¾ CPU å‹å¥½ï¼Œåˆèƒ½å…¼é¡¾å†…å­˜å‹å¥½ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Redis ä¸­çš„å®šæœŸåˆ é™¤å…·ä½“æ˜¯å¦‚ä½•åšçš„ã€‚

Redis çš„å®šæœŸåˆ é™¤è¿‡ç¨‹æ˜¯éšæœºçš„ï¼ˆå‘¨æœŸæ€§åœ°éšæœºä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­æŠ½æŸ¥ä¸€æ‰¹ï¼‰ï¼Œæ‰€ä»¥å¹¶ä¸ä¿è¯æ‰€æœ‰è¿‡æœŸé”®éƒ½ä¼šè¢«ç«‹å³åˆ é™¤ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæœ‰çš„ key è¿‡æœŸäº†ï¼Œå¹¶æ²¡æœ‰è¢«åˆ é™¤ã€‚å¹¶ä¸”ï¼ŒRedis åº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU æ—¶é—´çš„å½±å“ã€‚

å¦å¤–ï¼Œå®šæœŸåˆ é™¤è¿˜ä¼šå—åˆ°æ‰§è¡Œæ—¶é—´å’Œè¿‡æœŸ key çš„æ¯”ä¾‹çš„å½±å“ï¼š

- æ‰§è¡Œæ—¶é—´å·²ç»è¶…è¿‡äº†é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ä¸­æ–­è¿™ä¸€æ¬¡å®šæœŸåˆ é™¤å¾ªç¯ï¼Œä»¥é¿å…ä½¿ç”¨è¿‡å¤šçš„ CPU æ—¶é—´ã€‚
- å¦‚æœè¿™ä¸€æ‰¹è¿‡æœŸçš„ key æ¯”ä¾‹è¶…è¿‡ä¸€ä¸ªæ¯”ä¾‹ï¼Œå°±ä¼šé‡å¤æ‰§è¡Œæ­¤åˆ é™¤æµç¨‹ï¼Œä»¥æ›´ç§¯æåœ°æ¸…ç†è¿‡æœŸ keyã€‚ç›¸åº”åœ°ï¼Œå¦‚æœè¿‡æœŸçš„ key æ¯”ä¾‹ä½äºè¿™ä¸ªæ¯”ä¾‹ï¼Œå°±ä¼šä¸­æ–­è¿™ä¸€æ¬¡å®šæœŸåˆ é™¤å¾ªç¯ï¼Œé¿å…åšè¿‡å¤šçš„å·¥ä½œè€Œè·å¾—å¾ˆå°‘çš„å†…å­˜å›æ”¶ã€‚

Redis 7.2 ç‰ˆæœ¬çš„æ‰§è¡Œæ—¶é—´é˜ˆå€¼æ˜¯ **25ms**ï¼Œè¿‡æœŸ key æ¯”ä¾‹è®¾å®šå€¼æ˜¯ **10%**ã€‚

```
#define ACTIVE_EXPIRE_CYCLE_FAST_DURATION 1000 /* Microseconds. */
#define ACTIVE_EXPIRE_CYCLE_SLOW_TIME_PERC 25 /* Max % of CPU to use. */
#define ACTIVE_EXPIRE_CYCLE_ACCEPTABLE_STALE 10 /* % of stale keys after which
                                                   we do extra efforts. */
```

**æ¯æ¬¡éšæœºæŠ½æŸ¥æ•°é‡æ˜¯å¤šå°‘ï¼Ÿ**

`expire.c` ä¸­å®šä¹‰äº†æ¯æ¬¡éšæœºæŠ½æŸ¥çš„æ•°é‡ï¼ŒRedis 7.2 ç‰ˆæœ¬ä¸º 20ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ä¼šéšæœºé€‰æ‹© 20 ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚

```
#define ACTIVE_EXPIRE_CYCLE_KEYS_PER_LOOP 20 /* Keys for each DB loop. */
```

**å¦‚ä½•æ§åˆ¶å®šæœŸåˆ é™¤çš„æ‰§è¡Œé¢‘ç‡ï¼Ÿ**

åœ¨ Redis ä¸­ï¼Œå®šæœŸåˆ é™¤çš„é¢‘ç‡æ˜¯ç”± **hz** å‚æ•°æ§åˆ¶çš„ã€‚hz é»˜è®¤ä¸º 10ï¼Œä»£è¡¨æ¯ç§’æ‰§è¡Œ 10 æ¬¡ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿè¿›è¡Œ 10 æ¬¡å°è¯•æ¥æŸ¥æ‰¾å¹¶åˆ é™¤è¿‡æœŸçš„ keyã€‚

hz çš„å–å€¼èŒƒå›´ä¸º 1~500ã€‚å¢å¤§ hz å‚æ•°çš„å€¼ä¼šæå‡å®šæœŸåˆ é™¤çš„é¢‘ç‡ã€‚å¦‚æœä½ æƒ³è¦æ›´é¢‘ç¹åœ°æ‰§è¡Œå®šæœŸåˆ é™¤ä»»åŠ¡ï¼Œå¯ä»¥é€‚å½“å¢åŠ  hz çš„å€¼ï¼Œä½†è¿™ä¼šå¢åŠ  CPU çš„ä½¿ç”¨ç‡ã€‚æ ¹æ® Redis å®˜æ–¹å»ºè®®ï¼Œhz çš„å€¼ä¸å»ºè®®è¶…è¿‡ 100ï¼Œå¯¹äºå¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨é»˜è®¤çš„ 10 å°±è¶³å¤Ÿäº†ã€‚

ä¸‹é¢æ˜¯ hz å‚æ•°çš„å®˜æ–¹æ³¨é‡Šï¼Œæˆ‘ç¿»è¯‘äº†å…¶ä¸­çš„é‡è¦ä¿¡æ¯ï¼ˆRedis 7.2 ç‰ˆæœ¬ï¼‰ã€‚

![redis.conf å¯¹äº hz çš„æ³¨é‡Š](https://oss.javaguide.cn/github/javaguide/database/redis/redis.conf-hz.png)

ç±»ä¼¼çš„å‚æ•°è¿˜æœ‰ä¸€ä¸ª **dynamic-hz**ï¼Œè¿™ä¸ªå‚æ•°å¼€å¯ä¹‹å Redis å°±ä¼šåœ¨ hz çš„åŸºç¡€ä¸ŠåŠ¨æ€è®¡ç®—ä¸€ä¸ªå€¼ã€‚Redis æä¾›å¹¶é»˜è®¤å¯ç”¨äº†ä½¿ç”¨è‡ªé€‚åº” hz å€¼çš„èƒ½åŠ›ï¼Œ

è¿™ä¸¤ä¸ªå‚æ•°éƒ½åœ¨ Redis é…ç½®æ–‡ä»¶ `redis.conf` ä¸­ï¼š

```
# é»˜è®¤ä¸º 10
hz 10
# é»˜è®¤å¼€å¯
dynamic-hz yes
```

å¤šæä¸€å˜´ï¼Œé™¤äº†å®šæœŸåˆ é™¤è¿‡æœŸ key è¿™ä¸ªå®šæœŸä»»åŠ¡ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å®šæœŸä»»åŠ¡ä¾‹å¦‚å…³é—­è¶…æ—¶çš„å®¢æˆ·ç«¯è¿æ¥ã€æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›å®šæœŸä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡ä¹Ÿæ˜¯é€šè¿‡ hz å‚æ•°å†³å®šã€‚

**ä¸ºä»€ä¹ˆå®šæœŸåˆ é™¤ä¸æ˜¯æŠŠæ‰€æœ‰è¿‡æœŸ key éƒ½åˆ é™¤å‘¢ï¼Ÿ**

è¿™æ ·ä¼šå¯¹æ€§èƒ½é€ æˆå¤ªå¤§çš„å½±å“ã€‚å¦‚æœæˆ‘ä»¬ key æ•°é‡éå¸¸åºå¤§çš„è¯ï¼ŒæŒ¨ä¸ªéå†æ£€æŸ¥æ˜¯éå¸¸è€—æ—¶çš„ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚Redis è®¾è®¡è¿™ç§ç­–ç•¥çš„ç›®çš„æ˜¯ä¸ºäº†å¹³è¡¡å†…å­˜å’Œæ€§èƒ½ã€‚

**ä¸ºä»€ä¹ˆ key è¿‡æœŸä¹‹åä¸ç«‹é©¬æŠŠå®ƒåˆ æ‰å‘¢ï¼Ÿè¿™æ ·ä¸æ˜¯ä¼šæµªè´¹å¾ˆå¤šå†…å­˜ç©ºé—´å—ï¼Ÿ**

å› ä¸ºä¸å¤ªå¥½åŠåˆ°ï¼Œæˆ–è€…è¯´è¿™ç§åˆ é™¤æ–¹å¼çš„æˆæœ¬å¤ªé«˜äº†ã€‚å‡å¦‚æˆ‘ä»¬ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—ä½œä¸ºåˆ é™¤ç­–ç•¥ï¼Œè¿™æ ·å­˜åœ¨ä¸‹é¢è¿™äº›é—®é¢˜ï¼š

1. é˜Ÿåˆ—æœ¬èº«çš„å¼€é”€å¯èƒ½å¾ˆå¤§ï¼škey å¤šçš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—å¯èƒ½æ— æ³•å®¹çº³ã€‚
2. ç»´æŠ¤å»¶è¿Ÿé˜Ÿåˆ—å¤ªéº»çƒ¦ï¼šä¿®æ”¹ key çš„è¿‡æœŸæ—¶é—´å°±éœ€è¦è°ƒæ•´æœŸåœ¨å»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„ä½ç½®ï¼Œå¹¶ä¸”è¿˜éœ€è¦å¼•å…¥å¹¶å‘æ§åˆ¶ã€‚

### [å¤§é‡ key é›†ä¸­è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ](#å¤§é‡-key-é›†ä¸­è¿‡æœŸæ€ä¹ˆåŠ)

å½“ Redis ä¸­å­˜åœ¨å¤§é‡ key åœ¨åŒä¸€æ—¶é—´ç‚¹é›†ä¸­è¿‡æœŸæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- **è¯·æ±‚å»¶è¿Ÿå¢åŠ **ï¼šRedis åœ¨å¤„ç†è¿‡æœŸ key æ—¶éœ€è¦æ¶ˆè€— CPU èµ„æºï¼Œå¦‚æœè¿‡æœŸ key æ•°é‡åºå¤§ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹çš„ CPU å ç”¨ç‡å‡é«˜ï¼Œè¿›è€Œå½±å“å…¶ä»–è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œé€ æˆå»¶è¿Ÿå¢åŠ ã€‚
- **å†…å­˜å ç”¨è¿‡é«˜**ï¼šè¿‡æœŸçš„ key è™½ç„¶å·²ç»å¤±æ•ˆï¼Œä½†åœ¨ Redis çœŸæ­£åˆ é™¤å®ƒä»¬ä¹‹å‰ï¼Œä»ç„¶ä¼šå ç”¨å†…å­˜ç©ºé—´ã€‚å¦‚æœè¿‡æœŸ key æ²¡æœ‰åŠæ—¶æ¸…ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œç”šè‡³å¼•å‘å†…å­˜æº¢å‡ºã€‚

ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æ–¹æ¡ˆï¼š

1. **å°½é‡é¿å… key é›†ä¸­è¿‡æœŸ**ï¼šåœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´æ—¶å°½é‡éšæœºä¸€ç‚¹ã€‚
2. **å¼€å¯ lazy free æœºåˆ¶**ï¼šä¿®æ”¹ `redis.conf` é…ç½®æ–‡ä»¶ï¼Œå°† `lazyfree-lazy-expire` å‚æ•°è®¾ç½®ä¸º `yes`ï¼Œå³å¯å¼€å¯ lazy free æœºåˆ¶ã€‚å¼€å¯ lazy free æœºåˆ¶åï¼ŒRedis ä¼šåœ¨åå°å¼‚æ­¥åˆ é™¤è¿‡æœŸçš„ keyï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„è¿è¡Œï¼Œä»è€Œé™ä½å¯¹ Redis æ€§èƒ½çš„å½±å“ã€‚

### [Redis å†…å­˜æ·˜æ±°ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ](#redis-å†…å­˜æ·˜æ±°ç­–ç•¥äº†è§£ä¹ˆ)

> ç›¸å…³é—®é¢˜ï¼šMySQL é‡Œæœ‰ 2000w æ•°æ®ï¼ŒRedis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®?

Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥åªæœ‰åœ¨è¿è¡Œå†…å­˜è¾¾åˆ°äº†é…ç½®çš„æœ€å¤§å†…å­˜é˜ˆå€¼æ—¶æ‰ä¼šè§¦å‘ï¼Œè¿™ä¸ªé˜ˆå€¼æ˜¯é€šè¿‡ `redis.conf` çš„ `maxmemory` å‚æ•°æ¥å®šä¹‰çš„ã€‚64 ä½æ“ä½œç³»ç»Ÿä¸‹ï¼Œ`maxmemory` é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºä¸é™åˆ¶å†…å­˜å¤§å°ã€‚32 ä½æ“ä½œç³»ç»Ÿä¸‹ï¼Œé»˜è®¤çš„æœ€å¤§å†…å­˜å€¼æ˜¯ 3GBã€‚

ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤ `config get maxmemory` æ¥æŸ¥çœ‹ `maxmemory` çš„å€¼ã€‚

```
> config get maxmemory
maxmemory
0
```

Redis æä¾›äº† 6 ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š

1. **volatile-lruï¼ˆleast recently usedï¼‰**ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆ`server.db[i].expires`ï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚
2. **volatile-ttl**ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆ`server.db[i].expires`ï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚
3. **volatile-random**ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆ`server.db[i].expires`ï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚
4. **allkeys-lruï¼ˆleast recently usedï¼‰**ï¼šä»æ•°æ®é›†ï¼ˆ`server.db[i].dict`ï¼‰ä¸­ç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚
5. **allkeys-random**ï¼šä»æ•°æ®é›†ï¼ˆ`server.db[i].dict`ï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚
6. **no-eviction**ï¼ˆé»˜è®¤å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚

4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§ï¼š

7. **volatile-lfuï¼ˆleast frequently usedï¼‰**ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆ`server.db[i].expires`ï¼‰ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚
8. **allkeys-lfuï¼ˆleast frequently usedï¼‰**ï¼šä»æ•°æ®é›†ï¼ˆ`server.db[i].dict`ï¼‰ä¸­ç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚

`allkeys-xxx` è¡¨ç¤ºä»æ‰€æœ‰çš„é”®å€¼ä¸­æ·˜æ±°æ•°æ®ï¼Œè€Œ `volatile-xxx` è¡¨ç¤ºä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­æ·˜æ±°æ•°æ®ã€‚

`config.c` ä¸­å®šä¹‰äº†å†…å­˜æ·˜æ±°ç­–ç•¥çš„æšä¸¾æ•°ç»„ï¼š

```
configEnum maxmemory_policy_enum[] = {
    {"volatile-lru", MAXMEMORY_VOLATILE_LRU},
    {"volatile-lfu", MAXMEMORY_VOLATILE_LFU},
    {"volatile-random",MAXMEMORY_VOLATILE_RANDOM},
    {"volatile-ttl",MAXMEMORY_VOLATILE_TTL},
    {"allkeys-lru",MAXMEMORY_ALLKEYS_LRU},
    {"allkeys-lfu",MAXMEMORY_ALLKEYS_LFU},
    {"allkeys-random",MAXMEMORY_ALLKEYS_RANDOM},
    {"noeviction",MAXMEMORY_NO_EVICTION},
    {NULL, 0}
};
```

ä½ å¯ä»¥ä½¿ç”¨ `config get maxmemory-policy` å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚

```
> config get maxmemory-policy
maxmemory-policy
noeviction
```

å¯ä»¥é€šè¿‡ `config set maxmemory-policy å†…å­˜æ·˜æ±°ç­–ç•¥` å‘½ä»¤ä¿®æ”¹å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œç«‹å³ç”Ÿæ•ˆï¼Œä½†è¿™ç§æ–¹å¼é‡å¯ Redis ä¹‹åå°±å¤±æ•ˆäº†ã€‚ä¿®æ”¹ `redis.conf` ä¸­çš„ `maxmemory-policy` å‚æ•°ä¸ä¼šå› ä¸ºé‡å¯è€Œå¤±æ•ˆï¼Œä¸è¿‡ï¼Œéœ€è¦é‡å¯ä¹‹åä¿®æ”¹æ‰èƒ½ç”Ÿæ•ˆã€‚

```
maxmemory-policy noeviction
```

å…³äºæ·˜æ±°ç­–ç•¥çš„è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒ Redis å®˜æ–¹æ–‡æ¡£ï¼š[https://redis.io/docs/reference/eviction/](https://redis.io/docs/reference/eviction/)ã€‚

## [å‚è€ƒ](#å‚è€ƒ)

- ã€ŠRedis å¼€å‘ä¸è¿ç»´ã€‹
- ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹
- ã€ŠRedis æ ¸å¿ƒåŸç†ä¸å®æˆ˜ã€‹
- Redis å‘½ä»¤æ‰‹å†Œï¼š[https://www.redis.com.cn/commands.html](https://www.redis.com.cn/commands.html)
- RedisSearch ç»ˆæä½¿ç”¨æŒ‡å—ï¼Œä½ å€¼å¾—æ‹¥æœ‰ï¼ï¼š[https://mp.weixin.qq.com/s/FA4XVAXJksTOHUXMsayy2g](https://mp.weixin.qq.com/s/FA4XVAXJksTOHUXMsayy2g)
- WHY Redis choose single thread (vs multi threads): [https://medium.com/@jychen7/sharing-redis-single-thread-vs-multi-threads-5870bd44d153](https://medium.com/@jychen7/sharing-redis-single-thread-vs-multi-threads-5870bd44d153)

![JavaGuide å®˜æ–¹å…¬ä¼—å·](https://oss.javaguide.cn/github/javaguide/gongzhonghaoxuanchuan.png)

[ç¼–è¾‘æ­¤é¡µ](https://github.com/Snailclimb/JavaGuide/edit/main/docs/database/redis/redis-questions-01.md)

ä¸Šæ¬¡ç¼–è¾‘äº: 2025/3/11 19:43:01

è´¡çŒ®è€…: Snailclimb,Snailclimb,chenjiayang,SnailClimb,LiWenGuang,å½­æ™¨,dongzl,WangKai,Anthony,Kou Shuang,sid,Jiabin,shuang.kou,chenai,guide,das.friday.night,Veast,æ¡”å­,codingLemon,wulnm,TommyMerlin,å¤æœ¨,Qiwenlii,13350063660,ryq,sam,yueyang,hujesse83,liubobo,NoctisZhao,Guide,callmePicacho,Mr.Hope,aucub,Feng Wei,cxhello,wunameya,xuqi

[

ä¸Šä¸€é¡µ

ç¼“å­˜åŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä»˜è´¹)

](/database/redis/cache-basics.html)[

ä¸‹ä¸€é¡µ

Rediså¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)

](/database/redis/redis-questions-02.html)

[é„‚ICPå¤‡2020015769å·-1](https://beian.miit.gov.cn/)

Copyright Â© 2025 Guide