# 介绍下 Zookeeper 是什么?

Apache Zookeeper 是一个开源的分布式协调服务，它为分布式应用提供一致性服务，包括配置维护、域名服务、分布式同步、组服务等。Zookeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。

# Zookeeper 架构

Zookeeper 的架构包括以下组件：
- **Client**：客户端，与 Zookeeper 服务器交互。
- **Server**：Zookeeper 服务器，提供服务。
- **Leader**：负责处理所有写请求，并将写操作广播给所有 Follower。
- **Follower**：处理读请求，并将写请求转发给 Leader。
- **Observer**：处理读请求，但不参与投票和选举。

# Zookeeper 有什么作用？优缺点？有什么应用场景？

**作用**：
- **配置管理**：集中管理配置文件，实时更新。
- **命名服务**：提供统一的命名服务。
- **分布式锁**：实现分布式锁机制。
- **集群管理**：监控集群中节点的状态。
- **Leader 选举**：实现分布式系统中的 Leader 选举。

**优点**：
- **高可用性**：通过集群部署，提供高可用性。
- **一致性**：保证数据的一致性。
- **简单易用**：提供简单的 API 和接口。

**缺点**：
- **性能瓶颈**：在高并发场景下可能成为性能瓶颈。
- **复杂性**：部署和维护相对复杂。

**应用场景**：
- **分布式锁**：实现分布式锁机制。
- **配置管理**：集中管理配置文件。
- **Leader 选举**：实现分布式系统中的 Leader 选举。
- **集群管理**：监控集群中节点的状态。

# Zookeeper 的选举策略，leader 和 follower 的区别?

**选举策略**：
Zookeeper 使用 ZAB（Zookeeper Atomic Broadcast）协议进行 Leader 选举。在集群启动或 Leader 失效时，Zookeeper 会通过选举算法选出一个新的 Leader。

**Leader 和 Follower 的区别**：
- **Leader**：负责处理所有写请求，并将写操作广播给所有 Follower。
- **Follower**：处理读请求，并将写请求转发给 Leader。Follower 也会参与投票，帮助选举新的 Leader。

# 介绍下 Zookeeper 选举算法

Zookeeper 的选举算法基于 ZAB 协议，ZAB 协议基于 Paxos 算法，主要步骤如下：
- **发现阶段**：Follower 向其他节点发送自己看到的 Leader 信息，并收集其他节点的 Leader 信息。
- **同步阶段**：Follower 与 Leader 同步数据，确保数据一致。
- **广播阶段**：Leader 开始处理客户端请求，并将写操作广播给所有 Follower。

Zookeeper 通过 ZAB 协议保证数据的一致性。ZAB 协议确保所有写操作以原子方式广播给所有节点，并保证所有节点的数据一致。

Zookeeper 通过 ZAB 协议和法定人数（Quorum）机制来避免脑裂问题。ZAB 协议确保所有写操作以原子方式广播给所有节点，并保证所有节点的数据一致。法定人数机制确保在网络分区时，只有多数节点能够正常工作。
# Zookeeper 的节点类型有哪些？分别作用是什么？

Zookeeper 的节点类型包括：
- **持久节点（Persistent）**：节点创建后一直存在，直到被显式删除。
- **临时节点（Ephemeral）**：节点与客户端会话绑定，会话结束时节点自动删除。
- **持久顺序节点（Persistent Sequential）**：节点创建后一直存在，且 Zookeeper 会自动为节点名添加一个自增的数字后缀。
- **临时顺序节点（Ephemeral Sequential）**：节点与客户端会话绑定，会话结束时节点自动删除，且 Zookeeper 会自动为节点名添加一个自增的数字后缀。

# Zookeeper 的节点数怎么设置比较好?

Zookeeper 的节点数通常设置为奇数，以确保在少数节点失效时仍能正常工作。推荐的最小节点数为 3，这样可以容忍 1 个节点失效。

# Zookeeper 的数据结构(树)

**数据结构**：Zookeeper 的数据结构是一个树形结构，类似于文件系统的目录结构。每个节点称为 ZNode。

**分布式锁**：基于 Zookeeper 的临时顺序节点可以实现分布式锁。客户端创建一个临时顺序节点，并根据节点序号判断是否获得锁。

**Master 选举**：基于 Zookeeper 的临时节点可以实现 Master 选举。客户端创建一个临时节点，创建成功的客户端成为 Master。

**集群管理**：Zookeeper 可以监控集群中节点的状态。每个节点创建一个临时节点，节点失效时临时节点自动删除。

**注册 watch 机制使用场景**：Zookeeper 的注册 watch 机制用于监控节点的变化。使用场景包括：
- **配置管理**：监控配置文件的变化。
- **Leader 选举**：监控 Leader 节点的变化。
- **集群管理**：监控集群中节点的变化。

# Zookeeper 通知 / 发布订阅

Zookeeper 的消息发布订阅功能通过注册 watch 机制实现。客户端可以注册对某个节点的监控，当节点发生变化时，Zookeeper 会通知注册的客户端。

# Zookeeper 的数据存储

Zookeeper 的数据存储在内存中，同时也持久化到磁盘上。内存中的数据用于提供快速读取，磁盘上的数据用于持久化存储。

# Zookeeper 从三台扩容到七台怎么做?

Zookeeper 从三台扩容到七台的步骤如下：
1. **准备新节点**：准备新的 Zookeeper 节点，并配置好 Zookeeper 环境。
2. **更新配置**：更新所有节点的配置文件，包括新增节点的信息。
3. **启动新节点**：启动新增的 Zookeeper 节点。
4. **同步数据**：确保所有节点数据一致。
5. **验证集群**：验证集群状态，确保扩容成功。