---
---

传统存储管理方式具有==一次性和驻留性==的特征。

局部性原理，包括==时间局部性和空间局部性==。

**虚拟存储器特征**

- 多次性。==最重要特征==。作业允许被分成多次调入。
- 对换性。页面置换。
- 虚拟性。==最重要目标==.。逻辑上扩充了主存容量。

# 请求分页管理方式

所访问页面不存在内存时，==请求调页==从外存调到内存，放入空闲==页框==中；空间不足，==页面置换==。

**页表机制**

页表项：页号 + 物理页块 + ==状态位 P + 访问字段 A + 修改位 M + 外存地址==。

- 状态位 P 标志该页是否已调入内存。
- 访问字段 A 记录本页在一段时间内被访问的次数，或多长时间未被访问，供置换算法使用。

**缺页中断**。若请求页不在内存中，缺页进程请求中断，进入阻塞队列，调页完成后唤醒放回就绪队列。若内存中有空闲页框则将缺页放入，否则用置换算法选择页面淘汰，==若淘汰页被修改过则回写外存==。

**地址变换**

- 检索快表，命中则取出该页的物理块号，并修改页表项中的访问位。对于写指令还需改将修改位置为 1。
- 快表未命中，则到页表查找，若命中，取出该页的物理块号，并将==该页表项写入快表==。
- 页表未命中，则进行缺页中断处理，请求系统将改页从外存换入内存。系统更新页表和快表，并获得物理块号。
- 物理块号和页内地址拼接成物理地址，使用该地址进行访存。

# 页框分配

**驻留集大小**。给一个进程分配的==页框集合==就是这个进程的驻留集。

- 越小，驻留在内存中的进程就越多，但缺页率高。
- 越大，浪费空间，并发度下降。

**内存分配策略**

- 固定分配局部置换。
- 可变分配全局置换。
- 可变分配局部置换。

**物理块调入算法**

- 平均分配。
- 按比例分配。根据进程大小。
- 优先权分配。

**调入页面的时机**

- 预调页策略。主要用于进程首次调入，由程序员指出应该先调哪些页。
- 请求调页策略。

**从何处调入页面**

请求分页系统的外存分为==存放文件的文件区和存放对换页面的对换区==。

- 系统拥有足够的对换区空间。
- 系统缺少～。
- UNIX 方式。

**如何调入页面**。内存查找、缺页中断、页面置换、回写、更新页表。

# 页面置换算法

- **最佳置换算法 OPT**。最长时间内不再被访问（以后的使用情况）。
- **先进先出 FIFO**。基于队列实现，可能出现 Belady 异常（增加页框缺页率反而增加的异常行为）。
- **最近最久未使用 LRU**。堆栈类算法，需要寄存器和堆栈的硬件支持。
- **时钟置换算法 CLOCK**。循环遍历寻找访问位为 0 的页面。
	- 简单的～。只考虑访问位。
	- 改进的～。增加了修改位，优先考虑即未使用又未修改过的页。

频繁的页面调度行为称为==抖动==。

在某段时间间隔内，进程要访问的页面集合称为==工作集==。

# 内存映射文件

Memory-Mapped Files 是操作系统向应用程序提供的一个系统调用，将一个文件映射到其虚拟地址空间的某个区域，之后就用访问内存的方式读写文件（非 IO）。

访问时读，当进程退出或关闭文件映像时，被改动的页面才被写回磁盘。

通常，==共享内存==是通过映射相同的文件到通信进程的虚拟地址空间来实现的。