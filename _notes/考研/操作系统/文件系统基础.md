---
---

文件包含分类、索引、权限信息。

文件系统提供了与二级存储相关的资源抽象，方便用户使用文件。

文件的属性：名称、类型、创建者、所有者、位置、大小、保护、创建时间。

文件控制快 File Control Block FCB，一个 FCB 就是一个文件目录项。一个文件目录也是一个目录文件。FCB 必须连续存放。

检索目录只需要文件名，将文件描述信息单独形成一个称为==索引节点==的数据结构，简称 i 节点 inode。文件目录中只包含文件名和索引节点号。

- 磁盘索引节点（每个文件唯一）包括：文件主标识符、文件类型、文件存取权限、文件物理地址、文件长度、文件链接计数、文件存取时间。
- 内存索引节（文件被打开时，将磁盘索引节点复制到内存）点增加以下内容：索引节点号、状态、访问计数、逻辑设备号、链接指针。

**文件操作**

- 创建文件。分配外存空间；创建目录项。
- 删除文件。根据文件名查找目录，删除目录项和 FCB
- 读文件。根据文件名查找目录，读外存地址。目录项中有一个指针用于对文件进行读操作。
- 写文件。～。利用目录项写指针对文件进行写操作，每次写后要更新写指针。

==打开文件表==。通常采用两级表，整个系统表和每个进程表。多个进程打开同一个文件时，后面打开的进程只需在每个进程表中增加一个条目，并指向系统表的相应条目。

调用 `open()` 方法获取到文件描述符后，再操作文件不必使用文件名，故文件名不必包含在打开文件表中。

每个打开文件都包含如下关联信息。

- 文件指针。系统跟踪上次的读写位置作为当前文件位置的指针。
- 文件打开计数。
- 文件磁盘位置。
- 访问权限。

**文件保护**

通过口令保护、加密保护和访问控制等方式实现。

==Access-Control List ACL，访问控制列表==。拥有者、组、其他。

口令是系统级别的；密码是用户级别的。

**文件的逻辑结构**

- 无结构文件，由字符流构成，又称流式文件。
- 结构文件，又称流式文件。分为定长记录和变长记录。
	- 顺序文件。串结构，按存入先后顺序排序；顺序结构，按关键字排列，对于定长的可用折半查找。
	- 索引文件。
	- 索引顺序文件。
	- 直接文件或散列文件。

**文件的物理结构**

- ==连续分配==。寻道数和寻道时间最小。需要提前知道长度。删除插入需要物理移动。
- 链接分配。无外部碎片提高利用率。动态分配，修改方便。分为隐式，显式（文件分配表 File Allocation Table FAT）。
- 索引分配。
	- 单极索引。为每个文件分配一个索引块，索引到所有需要使用的块，访问文件时只调入索引的块至内存中。
	- 多级索引。
	- 混合索引。根据文件大小进行索引分配。

为了提高查找速度和减小指针所占用的存储空间，可以将几个盘块组成一个簇，==按簇分配==。代价是增加了内部碎片。