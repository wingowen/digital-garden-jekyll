---
---

# 基本原理和要求

**主要功能**

- 内存空间的分配与回收。
- 地址转换。逻辑与物理地址的转换。
- 内存空间的扩充。虚拟存储技术。
- 内存共享。
- 存储保护。

**程序的链接与装入**

将用户源程序变为可在内存中执行的程序，通常需要经历==编译、链接、装入==这三个步骤。

**装入方式**

- 绝对装入。只适用于单道程序环境。
- 可重定位装入。相对地址、静态重定位、必须分配连续的存储区。
- 动态运行时装入。动态重定位、执行时才做地址转换、存储区可不连续、便于程序段共享。

**链接方式**

- 静态链接。运行前先链接成一个完整的装入模块，需要解决两个问题：1）修改相对地址；2）变换外部调用符号。
- 装入时动态链接。
- 运行时动态链接。

**逻辑地址与物理地址**：进程使用虚拟内存空间中的地址，逻辑地址通过页表映射到物理内存，页表由操作系统维护并被处理器引用。

**进程的内存映像**：当一个程序调入内存运行时，就构成了进程的内存映像。一般有以下要素：==代码段、数据段、进程控制块、堆、栈==。

代码段和数据段在调入内存时就制定了大小，而堆栈可以在运行时动态地扩展和收缩。

**内存保护**：确保每个进程都有一个单独的内存空间。

- 在 CPU 中设置一对上、下限寄存器。
- 采用重定位寄存器 / 基地址寄存器和界地址寄存器 / 限长寄存器进行越界检查。界地址寄存区用来比较逻辑地址是否越界。

**内存共享**：只共享只读代码。可重入代码也称蠢代码，允许多个进程同时访问但不允许被任何进程修改的代码。

**内存的分配与回收**。

# 连续分配管理方式

- 单一连续分配。单道。内部碎片。
- 固定分区连续分配。分区大小相等 / 不等。最简单的多道。内部碎片。
- 动态分区分配。外部碎片，用紧凑技术。

**动态分区分配的内存回收方法**：回收的空间要在空闲分区链中找到相应的插入点，可能存在以下四种情况。

- 回收区与插入点前一空闲分区相邻，合并，修改前一分区大小为二者之合。
- 回收区与插入点后一空闲分区相邻，合并，修改后一分区的始址和大小。
- 前后相邻，合并三者，修改大小，取消后者分区表项。
- 无相邻，新建表项，初始化始址和大小，并插入。

**基于顺序搜索的分配算法**

- 首次适应。
- 邻近适应。从上次查找结束位置开始查找。
- 最佳适应。空闲分区递增排序，找到第一个满足的分区。
- 最坏适应。递减。

**基于索引搜索的分配算法**

- 快速适应算法。空闲分区按大小分为不同的链。
- 伙伴系统。所有的分区都为 2<sup>k</sup>。
- 哈希算法。根据分布规律建立哈希函数。

# 基本分页存储管理

==固定分区产生内部碎片，动态分区产生外部碎片，对内存利用率都较低==。

将内存空间分为若干固定大小的分区，称为==页框、页桢或物理块==。逻辑地址空间也分为与块带笑相等的若干区域，称为页==或页面==。

==操作系统以页框为单位为各个进程分配内存空间==。产生==页内碎片==。

==地址结构：页号 P + 页内偏移量 W==。

==页表==：进程的每个页面对应一个页表项，每个页表项由==页号和块号==组成，记录了页面在内存中对应的物理号。==页号到物理块号的地址映射==。

> 页号顺序存储，可以是隐含的，不占用存储空间。

==TLB 快表==。具有并行查找能力的高速缓冲存储器，相联存储器。先匹配快表，若命中则只需一次访存；若未找到则需要两次访存，读出表项并放入块表，若快表已满，并根据特定算法淘汰一个旧表项。

==二级页表==

# 基本分段存储管理

分页从计算机的角度考虑设计，提高内存利用率，提升计算机性能。==分页通过硬件机制实现，对用户完全透明==。

分段考虑了用户和程序员，以满足方便编程、信息保护和共享、动态增长及动态链接等多方面的需求。

分段系统中的逻辑地址结构：段号 S + 段内偏移量 W。由用户显式提供，在高级设计语言中由编译程序完成。

==段表：段号 + 段长 + 本段在主存的始址。==

==**分页和分段的对比==**

- 页是信息的物理单位，系统行为；段是逻辑单位，用户行为。
- 页的大小固定且由系统决定了；段长度不固定，取决于用户编写的程序。
- 分页管理地址空间是一维；分段管理地址空间是二维。

# 段页式存储管理

==逻辑地址结构：段号 S + 页号 P + 页内偏移量 W==。

每一个进程的段表只有一个，页表可能有多个。